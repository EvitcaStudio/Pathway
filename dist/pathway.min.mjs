/**
 * pathway@1.0.0 https://github.com/EvitcaStudio/Pathway
 * Compiled 4/7/2024, 3:17:41 AM UTC
 * 
 * pathway is licensed under a MIT styled License. See LICENSE.md for more info.
 * 
 * Copyright 2024, Evitca Studio, All Rights Reserved
 */
 var t={d:(e,i)=>{for(var r in i)t.o(i,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:i[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={},i=(t.d(e,{Z:()=>w}),{d:(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)}),n={},o=(i.d(n,{c:()=>h}),{d:(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)}),r={};o.d(r,{Y:()=>s});class s{constructor(t){this.RESET="[0m",this.BRIGHT="[1m",this.DIM="[2m",this.UNDERSCORE="[4m",this.BLINK="[5m",this.REVERSE="[7m",this.HIDDEN="[8m",this.FG_BLACK="[30m",this.FG_RED="[31m",this.FG_GREEN="[32m",this.FG_YELLOW="[33m",this.FG_BLUE="[34m",this.FG_MAGENTA="[35m",this.FG_CYAN="[36m",this.FG_WHITE="[37m",this.FG_GRAY="[90m",this.BG_BLACK="[40m",this.BG_RED="[41m",this.BG_GREEN="[42m",this.BG_YELLOW="[43m",this.BG_BLUE="[44m",this.BG_MAGENTA="[45m",this.BG_CYAN="[46m",this.BG_WHITE="[47m",this.BG_GRAY="[100m",this.TYPE_SPACER_LENGTH=13,this.types={default:this.FG_WHITE},this.currentType="",this.SPACE_CHAR=" ",this.FG_COLORS={};for(let t=0;t<=255;t++)this.FG_COLORS[t]="[38;5;"+t+"m";this.BG_COLORS={};for(let t=0;t<=255;t++)this.BG_COLORS[t]="[48;5;"+t+"m";Array.isArray(t)&&this.registerTypes(t)}prefix(t){return"string"==typeof t&&(this.currentType=t),this}message(e="log",...i){var r=this.currentType||"";if(0===r.length)console[e](...i);else{var n=r.length>=this.TYPE_SPACER_LENGTH;let t=this.types[r.toLowerCase()]?this.types[r.toLowerCase()]:this.types.default;var o=t.includes("");o||(t="color: "+t),!globalThis.window||o?console[e](t+r+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-r.length,n?1:0))+"|"+this.RESET,...i):console[e]("%c"+r+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-r.length,n?1:0))+"|",t,...i)}this.currentType=""}log(...t){this.message("log",...t)}info(...t){this.message("info",...t)}error(...t){this.message("error",...t)}warn(...t){this.message("warn",...t)}assert(...t){console.assert(...t)}debug(...t){this.message("debug",...t)}count(t){console.count(t)}countReset(t){console.countReset(t)}table(t,e){console.table(t,e)}time(t){this.message("time",t)}timeLog(t){this.message("timeLog",t)}timeEnd(t){this.message("timeEnd",t)}trace(...t){this.message("trace",...t)}group(t){this.message("group",t)}groupCollapsed(t){console.groupCollapsed(t)}groupEnd(){console.groupEnd()}clear(){console.clear()}registerType(t,e){this.types[t]||"string"==typeof t&&"string"==typeof e&&(this.types[t.toLowerCase()]=e)}registerTypes(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.registerType(e[t].type,e[t].ansi)}unregisterType(t){this.types[t]&&delete this.types[t]}}var a=r.Y;const h=new class{transitions={};storedIDs=[];version="1.0.0";constructor(){this.logger=new a,this.logger.registerType("Utils-Module","#ff6600")}decimalRand(t,e,i=1){return Number((Math.random()*(t-e)+e).toFixed(i))}rand(t,e){return t=Number(Math.random()*(t-e)+e),Math.round(t)}getPercentage(t,e){return 100*t/e}clamp(t,e=0,i=1){return Math.max(e,Math.min(t,i))}lerp(t,e,i){return(1-i)*t+i*e}flooredLerp(t,e,i){return Math.floor(this.lerp(t,e,i))}round(t,e=1){return Math.round(e*t)/e}normalize(t,e,i){return i-e==0?1:(t-e)/(i-e)}normalizeRanged(t,e,i){return i-e==0?1:(t=-(2*this.normalize(t,e,i)-1),this.clamp(t,-1,1))}within(t,e,i){return e<=t&&t<=i}formatIntegerWithCommas(t){return t.toFixed().toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}toRadians(t){return t*(Math.PI/180)}toDegrees(t){return t*(180/Math.PI)}pick(t){return t[Math.floor(Math.random()*t.length)]}removeProperties(t,e){if("object"==typeof t)for(const i in t)Array.isArray(e)&&e.includes(i)||t.hasOwnProperty(i)&&delete t[i]}prob(t){return!(t<=0)&&(100<=t||Math.floor(100*Math.random())+1<=t)}getInverseDirection(t){switch(t){case"north":return"south";case"south":return"north";case"east":return"west";case"west":return"east";case"northeast":return"southwest";case"northwest":return"southeast";case"southeast":return"northwest";case"southwest":return"northeast";default:this.logger.prefix("Utils-Module").error(`The direction ${t} is not supported.`)}}getAngleFromDirection(t){switch(t){case"north":return Math.PI/2;case"south":return 3*Math.PI/2;case"east":return 0;case"west":return Math.PI;case"northwest":return 3*Math.PI/4;case"northeast":return Math.PI/4;case"southwest":return 5*Math.PI/4;case"southeast":return 7*Math.PI/4;default:this.logger.prefix("Utils-Module").error(`The direction ${t} is not supported.`)}}centerRectangleOnParent(t,e,i,r,n,o){return{x:n+(i-t)/2,y:o+(r-e)/2}}getRandomAngle(){return Math.random()*(2*Math.PI)}getAngle(t,e){var i=t.y-e.y;return t=t.x-e.x,Math.atan2(i,t)}getAngle2(t,e){var i=t.y-e.y;return t=t.x-e.x,-1*(Math.atan2(i,t)-Math.PI)}convertRaWAngleToVyloCoords(t){return-1*(t-Math.PI)}getDistance(t,e){var i=t.y-e.y;return t=t.x-e.x,Math.sqrt(t*t+i*i)}calculateNewPositionFromDistanceAndAngle(t,e,i){var r={x:0,y:0};return r.x=t.x-e*Math.cos(i),r.y=t.y-e*Math.sin(i),r}calculateProportionalLength(t,e,i){return t/e*i}getDirection(t){return["east","northeast","north","northwest","west","southwest","south","southeast"][Math.abs(Math.floor(t*(180/Math.PI)/45+.5))%8]}linearDecay(t,e,i,r=.5){return Math.max(t*(1-e/i*r),1)}generateID(i=7){function t(){let e="";for(let t=0;t<i;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}let e=t();for(;this.storedIDs.includes(e);)e=t();return this.storedIDs.push(e),e}decimalToHex(t,e=6){return"#"+(t+Math.pow(16,e)).toString(16).slice(-e).toUpperCase()}addIntensity(t,e){var i=(t=this.grabColor(t).rgbArray)[0],r=t[1];t=t[2];let n=0,o=0,s=0;var a=0===i&&0===r&&0===t;return(i||a)&&(n=i+Math.floor(255*e/100)),(r||a)&&(o=r+Math.floor(255*e/100)),(t||a)&&(s=t+Math.floor(255*e/100)),this.grabColor(this.clamp(n,0,255),this.clamp(o,0,255),this.clamp(s,0,255)).hex}rgbToHex(t,e,i){return"#"+[this.clamp(t,0,255),this.clamp(e,0,255),this.clamp(i,0,255)].map(function(t){return t.toString(16).padStart(2,"0")}).join("")}hexToRgb(t){return t=(t=3===(t=t.replace("#","")).length?t.replace(new RegExp("(.)","g"),"$1$1"):t).match(new RegExp("..","g")),[this.clamp(parseInt(t[0],16),0,255),this.clamp(parseInt(t[1],16),0,255),this.clamp(parseInt(t[2],16),0,255)]}rgbToDecimal(t,e,i){return t<<16|e<<8|i}hexToDecimal(t){return t=t.replace("#",""),parseInt(t,16)}grabColor(t=this.getRandomColor(),e,i){let r,n;return"number"==typeof t&&"number"==typeof e&&"number"==typeof i?r=this.rgbToHex(t,e,i):("number"==typeof t&&(t=this.decimalToHex(t)),r=t,n=this.hexToRgb(r)),{hex:r.toLowerCase(),hexTagless:r.replace("#","").toLowerCase(),rgb:"rgb("+n[0]+","+n[1]+","+n[2]+")",rgbArray:n,rgbObject:{r:n[0],g:n[1],b:n[2]},rgbNormal:[Math.round(n[0]/255*100)/100,Math.round(n[1]/255*100)/100,Math.round(n[2]/255*100)/100],decimal:this.hexToDecimal(r)}}getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}getRandomColorBetween(t,e,i=.5){return this.flooredLerp(this.grabColor(t).decimal,this.grabColor(e).decimal,i)}transitionColor(h,t="#000",e="#fff",l=1e3,i,r){if(globalThis.window){const c="function"==typeof i?i:null,u="function"==typeof r?r:null;let o,s,a;h?(o=h.id||this.generateID(),s="GeneratedParticle"===h.type,a="object"==typeof h.color&&h.color.constructor===Object,this.transitions[o]&&this.cancelTransitionColor(o)):o=this.generateID(),this.transitions[o]={duration:l,timeTracker:s?h.info.lifetime:0};const p=this.grabColor(t).rgbArray,g=this.grabColor(e).rgbArray,d=this;return this.transitions[o].step=t=>{if(d.transitions[o]){if(s){if(!h.info)return void(d.transitions[o]&&this.cancelTransitionColor(o));if(h.info.owner&&h.info.owner.settings.paused)return}d.transitions[o].lastTime||(d.transitions[o].lastTime=t);var e=t-d.transitions[o].lastTime,i=(d.transitions[o].timeTracker+=e,e=Math.min(d.transitions[o].timeTracker/d.transitions[o].duration,1),parseInt(d.lerp(p[0],g[0],e),10)),r=parseInt(d.lerp(p[1],g[1],e),10),n=parseInt(d.lerp(p[2],g[2],e),10),i=d.grabColor(i,r,n);c&&c(i),h&&(a?(h.color.tint=i.decimal,h.color=h.color):h.color=i.hex),1<=e||d.transitions[o].timeTracker>=l?(d.transitions[o]&&this.cancelTransitionColor(o),u&&u(i)):(d.transitions[o].req=globalThis.requestAnimationFrame(d.transitions[o].step),d.transitions[o].lastTime=t)}},this.transitions[o].req=globalThis.requestAnimationFrame(this.transitions[o].step),o}}cancelTransitionColor(t){this.transitions[t]&&(globalThis.cancelAnimationFrame(this.transitions[t].req),delete this.transitions[t])}getPointRotated(t,e,i){var r=t.x+t.width*("object"==typeof t.anchor&&t.anchor.x?t.anchor.x:.5),n=(t=t.y+t.height*("object"==typeof t.anchor&&t.anchor.y?t.anchor.y:.5),i.x-r);return i=i.y-t,{x:n*Math.cos(e)-i*-Math.sin(e)+r,y:n*-Math.sin(e)+i*Math.cos(e)+t}}getPointsOfRotatedRect(t,e){return{tl:this.getPointRotated(t,e,{x:t.x,y:t.y}),tr:this.getPointRotated(t,e,{x:t.x+t.width,y:t.y}),bl:this.getPointRotated(t,e,{x:t.x,y:t.y+t.height}),br:this.getPointRotated(t,e,{x:t.x+t.width,y:t.y+t.height}),center:this.getPointRotated(t,e,{x:t.x+t.width/2,y:t.y+t.height/2})}}calculateIconOffset(t={width:32,height:32},e={x:.5,y:.5},i={x:1,y:1}){var r=t.width*i.x,i=t.height*i.y;return{x:e.x*(r-t.width),y:e.y*(i-t.height)}}};var l=n.c,c={d:(t,e)=>{for(var i in e)c.o(e,i)&&!c.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},u={};c.d(u,{Y:()=>p});class p{constructor(t){this.RESET="[0m",this.BRIGHT="[1m",this.DIM="[2m",this.UNDERSCORE="[4m",this.BLINK="[5m",this.REVERSE="[7m",this.HIDDEN="[8m",this.FG_BLACK="[30m",this.FG_RED="[31m",this.FG_GREEN="[32m",this.FG_YELLOW="[33m",this.FG_BLUE="[34m",this.FG_MAGENTA="[35m",this.FG_CYAN="[36m",this.FG_WHITE="[37m",this.FG_GRAY="[90m",this.BG_BLACK="[40m",this.BG_RED="[41m",this.BG_GREEN="[42m",this.BG_YELLOW="[43m",this.BG_BLUE="[44m",this.BG_MAGENTA="[45m",this.BG_CYAN="[46m",this.BG_WHITE="[47m",this.BG_GRAY="[100m",this.TYPE_SPACER_LENGTH=13,this.types={default:this.FG_WHITE},this.currentType="",this.SPACE_CHAR=" ",this.FG_COLORS={};for(let t=0;t<=255;t++)this.FG_COLORS[t]="[38;5;"+t+"m";this.BG_COLORS={};for(let t=0;t<=255;t++)this.BG_COLORS[t]="[48;5;"+t+"m";Array.isArray(t)&&this.registerTypes(t)}prefix(t){return"string"==typeof t&&(this.currentType=t),this}message(e="log",...i){var r=this.currentType||"";if(0===r.length)console[e](...i);else{var n=r.length>=this.TYPE_SPACER_LENGTH;let t=this.types[r.toLowerCase()]?this.types[r.toLowerCase()]:this.types.default;var o=t.includes("");o||(t="color: "+t),!globalThis.window||o?console[e](t+r+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-r.length,n?1:0))+"|"+this.RESET,...i):console[e]("%c"+r+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-r.length,n?1:0))+"|",t,...i)}this.currentType=""}log(...t){this.message("log",...t)}info(...t){this.message("info",...t)}error(...t){this.message("error",...t)}warn(...t){this.message("warn",...t)}assert(...t){console.assert(...t)}debug(...t){this.message("debug",...t)}count(t){console.count(t)}countReset(t){console.countReset(t)}table(t,e){console.table(t,e)}time(t){this.message("time",t)}timeLog(t){this.message("timeLog",t)}timeEnd(t){this.message("timeEnd",t)}trace(...t){this.message("trace",...t)}group(t){this.message("group",t)}groupCollapsed(t){console.groupCollapsed(t)}groupEnd(){console.groupEnd()}clear(){console.clear()}registerType(t,e){this.types[t]||"string"==typeof t&&"string"==typeof e&&(this.types[t.toLowerCase()]=e)}registerTypes(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.registerType(e[t].type,e[t].ansi)}unregisterType(t){this.types[t]&&delete this.types[t]}}var g=u.Y;function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var y={731:function(t,e,i){t.exports=i(297)},297:function(a,m){var T,x;!function(){var t,p,h,g,d,e,l,i,y,f,r,n,o,c,u;function s(t){this.cmp=null!=t?t:p,this.nodes=[]}h=Math.floor,f=Math.min,p=function(t,e){return t<e?-1:e<t?1:0},y=function(t,e,i,r,n){var o;if(null==n&&(n=p),(i=null==i?0:i)<0)throw new Error("lo must be non-negative");for(null==r&&(r=t.length);i<r;)n(e,t[o=h((i+r)/2)])<0?r=o:i=o+1;return[].splice.apply(t,[i,i-i].concat(e)),e},d=function(t,e){var i,r;return null==e&&(e=p),i=t.pop(),t.length?(r=t[0],t[0]=i,u(t,0,e)):r=i,r},i=function(t,e,i){var r;return null==i&&(i=p),r=t[0],t[0]=e,u(t,0,i),r},l=function(t,e,i){var r;return null==i&&(i=p),t.length&&i(t[0],e)<0&&(e=(r=[t[0],e])[0],t[0]=r[1],u(t,0,i)),e},g=function(i,t){var e,r,n,o,s,a;for(null==t&&(t=p),s=[],r=0,n=(o=function(){a=[];for(var t=0,e=h(i.length/2);0<=e?t<e:e<t;0<=e?t++:t--)a.push(t);return a}.apply(this).reverse()).length;r<n;r++)e=o[r],s.push(u(i,e,t));return s},o=function(t,e,i){if(null==i&&(i=p),-1!==(e=t.indexOf(e)))return c(t,0,e,i),u(t,e,i)},r=function(t,e,i){var r,n,o,s,a;if(null==i&&(i=p),!(n=t.slice(0,e)).length)return n;for(g(n,i),o=0,s=(a=t.slice(e)).length;o<s;o++)r=a[o],l(n,r,i);return n.sort(i).reverse()},n=function(t,e,i){var r,n,o,s,a,h,l,c,u;if(null==i&&(i=p),10*e<=t.length){if((o=t.slice(0,e).sort(i)).length)for(n=o[o.length-1],s=0,h=(l=t.slice(e)).length;s<h;s++)i(r=l[s],n)<0&&(y(o,r,0,null,i),o.pop(),n=o[o.length-1]);return o}for(g(t,i),u=[],a=0,c=f(e,t.length);0<=c?a<c:c<a;0<=c?++a:--a)u.push(d(t,i));return u},c=function(t,e,i,r){var n,o,s;for(null==r&&(r=p),n=t[i];e<i&&r(n,o=t[s=i-1>>1])<0;)t[i]=o,i=s;return t[i]=n},u=function(t,e,i){var r,n,o,s,a;for(null==i&&(i=p),n=t.length,o=t[a=e],r=2*e+1;r<n;)(s=r+1)<n&&!(i(t[r],t[s])<0)&&(r=s),t[e]=t[r],r=2*(e=r)+1;return t[e]=o,c(t,a,e,i)},s.push=e=function(t,e,i){return null==i&&(i=p),t.push(e),c(t,0,t.length-1,i)},s.pop=d,s.replace=i,s.pushpop=l,s.heapify=g,s.updateItem=o,s.nlargest=r,s.nsmallest=n,s.prototype.push=function(t){return e(this.nodes,t,this.cmp)},s.prototype.pop=function(){return d(this.nodes,this.cmp)},s.prototype.peek=function(){return this.nodes[0]},s.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},s.prototype.replace=function(t){return i(this.nodes,t,this.cmp)},s.prototype.pushpop=function(t){return l(this.nodes,t,this.cmp)},s.prototype.heapify=function(){return g(this.nodes,this.cmp)},s.prototype.updateItem=function(t){return o(this.nodes,t,this.cmp)},s.prototype.clear=function(){return this.nodes=[]},s.prototype.empty=function(){return 0===this.nodes.length},s.prototype.size=function(){return this.nodes.length},s.prototype.clone=function(){var t=new s;return t.nodes=this.nodes.slice(0),t},s.prototype.toArray=function(){return this.nodes.slice(0)},s.prototype.insert=s.prototype.push,s.prototype.top=s.prototype.peek,s.prototype.front=s.prototype.peek,s.prototype.has=s.prototype.contains,s.prototype.copy=s.prototype.clone,t=s,x=[],void 0!==(x="function"==typeof(T=function(){return t})?T.apply(m,x):T)&&(a.exports=x)}.call(this)}},f={};function m(t){var e=f[t];return void 0===e&&(e=f[t]={exports:{}},y[t].call(e.exports,e,e.exports,m)),e.exports}m.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return m.d(e,{a:e}),e},m.d=function(t,e){for(var i in e)m.o(e,i)&&!m.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},m.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var T={},x=(function(){m.d(T,{x:function(){return i}});t=function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},Object.defineProperty(t,"prototype",{writable:!1});var w=t;function s(t){return(s="function"==typeof Symbol&&"symbol"==d(Symbol.iterator)?function(t){return d(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":d(t)})(t)}var P=function(){for(var t,e,e=function t(e,i,r,n,o){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.parent=e,this.x=i,this.y=r,this.costSoFar=n,this.simpleDistanceToTarget=o},i=e.prototype,r=[{key:"bestGuessDistance",value:function(){return this.costSoFar+this.simpleDistanceToTarget}}],n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,(t=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return String(t);if("object"!=s(e=e.call(t,"string")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(o.key),"symbol"==s(t)?t:t+""),o)}return Object.defineProperty(e,"prototype",{writable:!1}),e}(),t=m(731),E=m.n(t),i={},M=1;i.js=function(){var c,o,u,p=!1,s={},r={},n={},h={},a=!0,g={},d=[],l=Number.MAX_VALUE,y=!1,f=(this.setAcceptableTiles=function(t){t instanceof Array?u=t:!isNaN(parseFloat(t))&&isFinite(t)&&(u=[t])},this.enableSync=function(){p=!0},this.disableSync=function(){p=!1},this.enableDiagonals=function(){y=!0},this.disableDiagonals=function(){y=!1},this.setGrid=function(t){c=t;for(var e=0;e<c.length;e++)for(var i=0;i<c[0].length;i++)r[c[e][i]]||(r[c[e][i]]=1)},this.setTileCost=function(t,e){r[t]=e},this.setAdditionalPointCost=function(t,e,i){void 0===n[e]&&(n[e]={}),n[e][t]=i},this.removeAdditionalPointCost=function(t,e){void 0!==n[e]&&delete n[e][t]},this.removeAllAdditionalPointCosts=function(){n={}},this.setDirectionalCondition=function(t,e,i){void 0===h[e]&&(h[e]={}),h[e][t]=i},this.removeAllDirectionalConditions=function(){h={}},this.setIterationsPerCalculation=function(t){l=t},this.avoidAdditionalPoint=function(t,e){void 0===s[e]&&(s[e]={}),s[e][t]=1},this.stopAvoidingAdditionalPoint=function(t,e){void 0!==s[e]&&delete s[e][t]},this.enableCornerCutting=function(){a=!0},this.disableCornerCutting=function(){a=!1},this.stopAvoidingAllAdditionalPoints=function(){s={}},this.findPath=function(t,e,i,r,n){function o(t){p?n(t):setTimeout(function(){n(t)})}if(void 0===u)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===c)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(t<0||e<0||i<0||r<0||t>c[0].length-1||e>c.length-1||i>c[0].length-1||r>c.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(t===i&&e===r)o([]);else{for(var s,a=c[r][i],h=!1,l=0;l<u.length;l++)if(a===u[l]){h=!0;break}if(!1!==h)return(s=new w).openList=new(E())(function(t,e){return t.bestGuessDistance()-e.bestGuessDistance()}),s.isDoneCalculating=!1,s.nodeHash={},s.startX=t,s.startY=e,s.endX=i,s.endY=r,s.callback=o,s.openList.push(b(s,s.startX,s.startY,null,1)),t=M++,g[t]=s,d.push(t),t;o(null)}},this.cancelPath=function(t){return t in g&&(delete g[t],!0)},this.calculate=function(){if(0!==d.length&&void 0!==c&&void 0!==u)for(o=0;o<l;o++){if(0===d.length)return;p&&(o=0);var t=d[0],e=g[t];if(void 0===e)d.shift();else if(0===e.openList.size())e.callback(null),delete g[t],d.shift();else{var i=e.openList.pop();if(e.endX===i.x&&e.endY===i.y){for(var r=[],n=(r.push({x:i.x,y:i.y}),i.parent);null!=n;)r.push({x:n.x,y:n.y}),n=n.parent;r.reverse(),e.callback(r),delete g[t],d.shift()}else(i.list=0)<i.y&&f(e,i,0,-1,+x(i.x,i.y-1)),i.x<c[0].length-1&&f(e,i,1,0,+x(i.x+1,i.y)),i.y<c.length-1&&f(e,i,0,1,+x(i.x,i.y+1)),0<i.x&&f(e,i,-1,0,+x(i.x-1,i.y)),y&&(0<i.x&&0<i.y&&(a||m(c,u,i.x,i.y-1,i)&&m(c,u,i.x-1,i.y,i))&&f(e,i,-1,-1,1.4*x(i.x-1,i.y-1)),i.x<c[0].length-1&&i.y<c.length-1&&(a||m(c,u,i.x,i.y+1,i)&&m(c,u,i.x+1,i.y,i))&&f(e,i,1,1,1.4*x(i.x+1,i.y+1)),i.x<c[0].length-1&&0<i.y&&(a||m(c,u,i.x,i.y-1,i)&&m(c,u,i.x+1,i.y,i))&&f(e,i,1,-1,1.4*x(i.x+1,i.y-1)),0<i.x)&&i.y<c.length-1&&(a||m(c,u,i.x,i.y+1,i)&&m(c,u,i.x-1,i.y,i))&&f(e,i,-1,1,1.4*x(i.x-1,i.y+1))}}},function(t,e,i,r,n){i=e.x+i,r=e.y+r,void 0!==s[r]&&void 0!==s[r][i]||!m(c,u,i,r,e)||(void 0===(i=b(t,i,r,e,n)).list?(i.list=1,t.openList.push(i)):e.costSoFar+n<i.costSoFar&&(i.costSoFar=e.costSoFar+n,i.parent=e,t.openList.updateItem(i)))}),m=function(t,e,i,r,n){var o=h[r]&&h[r][i];if(o){var s=T(n.x-i,n.y-r);if(!function(){for(var t=0;t<o.length;t++)if(o[t]===s)return 1}())return!1}for(var a=0;a<e.length;a++)if(t[r][i]===e[a])return!0;return!1},T=function(t,e){if(0===t&&-1===e)return i.TOP;if(1===t&&-1===e)return i.TOP_RIGHT;if(1===t&&0===e)return i.RIGHT;if(1===t&&1===e)return i.BOTTOM_RIGHT;if(0===t&&1===e)return i.BOTTOM;if(-1===t&&1===e)return i.BOTTOM_LEFT;if(-1===t&&0===e)return i.LEFT;if(-1===t&&-1===e)return i.TOP_LEFT;throw new Error("These differences are not valid: "+t+", "+e)},x=function(t,e){return n[e]&&n[e][t]||r[c[e][t]]},b=function(t,e,i,r,n){if(void 0!==t.nodeHash[i]){if(void 0!==t.nodeHash[i][e])return t.nodeHash[i][e]}else t.nodeHash[i]={};var o=v(e,i,t.endX,t.endY);return n=null!==r?r.costSoFar+n:0,r=new P(r,e,i,n,o),t.nodeHash[i][e]=r},v=function(t,e,i,r){var n,o;return y?(n=Math.abs(t-i))<(o=Math.abs(e-r))?1.4*n+o:1.4*o+n:(n=Math.abs(t-i))+Math.abs(e-r)}},i.TOP="TOP",i.TOP_RIGHT="TOP_RIGHT",i.RIGHT="RIGHT",i.BOTTOM_RIGHT="BOTTOM_RIGHT",i.BOTTOM="BOTTOM",i.BOTTOM_LEFT="BOTTOM_LEFT",i.LEFT="LEFT",i.TOP_LEFT="TOP_LEFT"}(),T.x);class b{static MAX_STUCK_COUNTER=1e3;static MAX_NEAREST_TILE_SEARCH=6;static MAX_DELTA_TIME=.03333333333;static CLAMPED_DELTA_TIME=.01666666666;static AVERSION_WEIGHT=10;static NO_TRAVEL_WEIGHT=999999999;static storedMapTiles={};static DEFAULT_TILE_SIZE={width:32,height:32};tileSize={...b.DEFAULT_TILE_SIZE};version="1.0.0";instanceWeakMap=new WeakMap;lastTime=0;deltaTime=0;elapsedMS=0;constructor(){this.logger=new g,this.logger.registerType("Pathway-Module","#ff6600")}async to(n,o,s){if("object"==typeof n)if(n.mapName)if("object"!=typeof o)this.logger.prefix("Pathway-Module").error("Invalid type passed for pDestination. Expecting an object.");else if("object"!=typeof s)this.logger.prefix("Pathway-Module").error("Invalid type passed for pOptions. Expecting an object.");else{let e=this.instanceWeakMap.get(n);if(!e){const o="collision"===s.mode?"collision":"position";(e={trajectory:{angle:0,x:0,y:0,nextNodePos:null},currentPosition:{x:0,y:0},previousPosition:{x:0,y:0},stuckCounter:0,pathID:null,path:null,positionFromCenter:s.center,moving:null,mode:o,easystar:new x.js}).easystar.setIterationsPerCalculation(1e3),this.instanceWeakMap.set(n,e)}this.end(n);var a=this.getPositionFromInstance(n),h=VYLO.Map.getLocByPos(a.x,a.y,n.mapName);let t;Array.isArray(s.ignore)&&((t=[...s.ignore]).includes(h)||(t.push(h),t.push(n))),s.diagonal&&(e.easystar.enableDiagonals(),e.easystar.enableCornerCutting());var c=this.mapTilesToGrid(n.mapName,t);e.easystar.setGrid(c.grid),c.weights.forEach(t=>{e.easystar.setTileCost(t,t)}),e.easystar.setAcceptableTiles(c.acceptedTiles);const p=l.clamp(l.clamp(o.x-1,0,mapSize.x)*this.tileSize.width+this.tileSize.width/2,0,mapSize.xPos-this.tileSize.width),g=l.clamp(l.clamp(o.y-1,0,mapSize.y)*this.tileSize.height+this.tileSize.height/2,0,mapSize.yPos-this.tileSize.height),d=VYLO.Map.getLocByPos(p,g,n.mapName);let i=this.tileToNode(h),r=this.tileToNode(d);if(this.debugging){const n=VYLO.newDiob();n.atlasName="",n.width=this.tileSize.width,n.height=this.tileSize.height,n.tint=16777215,n.alpha=.7,n.plane=0,n.touchOpacity=0,n.touchOpacity=0,n.setTransition({alpha:0},-1,debuggerDuration),d.addOverlay(n),setTimeout(()=>{d.removeOverlay(n)},debuggerDuration)}if(this.isTileInvalid(h)){var u={west:!1,east:!1,north:!1,south:!1};if(s.nearest){for(const n of h.getContents())if(n.density){const s=this.getBlockingSides(n,a.x,a.y,p,g);s.west&&(u.west=!0),s.east&&(u.east=!0),s.north&&(u.north=!0),s.south&&(u.south=!0)}c=this.getNearestNode(n,i,a.x,a.y,u,!0);if(u.west){const o=VYLO.Map.getLocByPos(a.x+this.tileSize.width/2,a.y,n.mapName);this.isTileInvalid(o)&&c.x++}if(u.east){const o=VYLO.Map.getLocByPos(a.x-this.tileSize.width/2,a.y,n.mapName);this.isTileInvalid(o)&&c.x--}if(u.north){const o=VYLO.Map.getLocByPos(a.x,a.y+this.tileSize.height/2,n.mapName);this.isTileInvalid(o)&&c.y++}if(u.south){const o=VYLO.Map.getLocByPos(a.x,a.y-this.tileSize.height/2,n.mapName);this.isTileInvalid(o)&&c.y--}i=c}if(!s.nearest||u.west&&u.east&&u.north&&u.south){if(this.debugging){const n=VYLO.newDiob();n.atlasName="",n.width=this.tileSize.width,n.height=this.tileSize.height,n.tint=16711680,n.alpha=.7,n.plane=0,n.touchOpacity=0,n.touchOpacity=0,n.setTransition({alpha:0},-1,debuggerDuration),startTile.addOverlay(n),setTimeout(()=>{d.removeOverlay(n)},debuggerDuration)}return"function"==typeof self.onPathNotFound&&self.onPathNotFound(),void this.end(n)}}if(this.isTileInvalid(d)){if(!s.nearest)return"function"==typeof self.onPathNotFound&&self.onPathNotFound(),this.debugging&&d.getOverlays().filter(t=>{t.tint=16711680}),void this.end(n);r=this.getNearestNode(n,r,p,g)}o=this.getPath({x:i.x,y:i.y},{x:r.x,y:r.y});e.path=o.path,e.pathID=o.pathID,o.path?"function"==typeof self.onPathFound&&self.onPathFound():("function"==typeof self.onPathNotFound&&self.onPathNotFound(),this.end(n))}else this.logger.prefix("Pathway-Module").error("Cannot generate a path. pInstance is not on a map.");else this.logger.prefix("Pathway-Module").error("Invalid type passed for pInstance. Expecting an object.")}end(t){var e=this.instanceWeakMap.get(t);e?(e.pathID&&(e.easystar.cancelPath(e.pathID),e.pathID=null),e.easystar.disableDiagonals(),e.easystar.disableCornerCutting(),e.positionFromCenter=!1,e.trajectory.x=0,e.trajectory.y=0,e.trajectory.angle=0,e.trajectory.nextNodePos=null,e.stuckCounter=0,e.path.length=0,e.moving=!1,e.mode="collision",t.move()):this.logger.prefix("Pathway-Module").error("No instance data found from pInstance. This instance is not engaged in pathfinding.")}getNearestNode(r,n,o,s,a={west:!1,east:!1,north:!1,south:!1},h){const c=this.getPositionFromInstance(r);if(n){let t,e={},i={};for(let t=1;t<=b.MAX_NEAREST_TILE_SEARCH;t++){var u=VYLO.Map.getLocByPos(o-t*this.tileSize.width/2,s,r.mapName),p=VYLO.Map.getLocByPos(o+t*this.tileSize.width/2,s,r.mapName),g=VYLO.Map.getLocByPos(o,s-t*this.tileSize.height/2,r.mapName),d=VYLO.Map.getLocByPos(o,s+t*this.tileSize.height/2,r.mapName);!u||a.west||u.density&&!ignoreList.includes(u)||u.getContents().filter(t=>{var e=!h||l.within(c.y,t.y+t.yOrigin,t.yOrigin+t.height);if(t.density&&!ignoreList.includes(t)&&e)return t.density}).length?(u&&(i[u.id]=u),t<=1&&(a.west=!0)):e[u.id]=u,!p||a.east||p.density&&!ignoreList.includes(p)||p.getContents().filter(t=>{var e=!h||l.within(c.y,t.y+t.yOrigin,t.yOrigin+t.height);if(t.density&&!ignoreList.includes(t)&&e)return t.density}).length?(p&&(i[p.id]=p),t<=1&&(a.east=!0)):e[p.id]=p,!g||a.north||g.density&&!ignoreList.includes(g)||g.getContents().filter(t=>{var e=!h||l.within(c.x,t.x+t.xOrigin,t.xOrigin+t.width);if(t.density&&!ignoreList.includes(t)&&e)return t.density}).length?(g&&(i[g.id]=g),t<=1&&(a.north=!0)):e[g.id]=g,!d||a.south||d.density&&!ignoreList.includes(d)||d.getContents().filter(t=>{var e=!h||l.within(c.x,t.x+t.xOrigin,t.xOrigin+t.width);if(t.density&&!ignoreList.includes(t)&&e)return t.density}).length?(d&&(i[d.id]=d),t<=1&&(a.south=!0)):e[d.id]=d}if(this.debugging)for(const r in i){const n=VYLO.newDiob();n.tint=16711680,n.atlasName="",n.width=this.tileSize.width,n.height=this.tileSize.height,n.tint=h?16753920:16711680,n.alpha=.3,n.plane=0,n.mouseOpacity=0,n.touchOpacity=0,n.setTransition({alpha:0},-1,debuggerDuration),i[r].addOverlay(n),setTimeout(()=>{i[r].removeOverlay(n)},debuggerDuration)}for(const r in e){if(this.debugging){const n=VYLO.newDiob();n.tint=16711680,n.atlasName="",n.width=this.tileSize.width,n.height=this.tileSize.height,n.tint=h?8900331:65280,n.alpha=.3,n.plane=0,n.mouseOpacity=0,n.touchOpacity=0,n.setTransition({alpha:0},-1,debuggerDuration),e[r].addOverlay(n),setTimeout(()=>{e[r].removeOverlay(n)},debuggerDuration)}const o=this.tileToNode(e[r]);if(t){const r=l.getDistance(n,t);l.getDistance(n,o)<r&&(t=o)}else t=o}return t||n}}getBlockingSides(t,e,i,r,n){t=this.getPositionFromInstance(t);return{west:r<=t.x&&e>=t.x,east:r>=t.x&&e<=t.x,north:n<=t.y&&i>=t.y,south:n>=t.y&&i<=t.y}}getPositionFromInstance(t){var e=this.instanceWeakMap.get(t);if(e)return e.positionFromCenter?t.icon.width&&t.icon.height?(e.currentPosition.x=Math.floor(t.x+t.icon.width/2),e.currentPosition.y=Math.floor(t.y+t.icon.height/2)):(e.currentPosition.x=Math.floor(t.x+t.xOrigin+t.width/2),e.currentPosition.y=Math.floor(t.y+t.yOrigin+t.height/2)):(e.currentPosition.x=t.x,e.currentPosition.y=t.y),e.currentPosition}update(){const t=null,e=this.instanceWeakMap.get(t);if(e){var i=Date.now();if(this.elapsedMS=i-this.lastTime,this.deltaTime=this.elapsedMS/1e3,this.deltaTime>=b.MAX_DELTA_TIME&&(this.deltaTime=b.CLAMPED_DELTA_TIME),e.easystar.calculate(),e.path.length||e.moving){var r=this.getPositionFromInstance(t);if(e.moving)Math.floor(l.getDistance(r,e.trajectory.nextNodePos))<=t.moveSettings.stepSize?(e.moving=!1,e.stuckCounter=0,e.path.length||("function"==typeof self.onPathComplete&&self.onPathComplete(e.pathID),this.end(t))):(e.trajectory.angle=l.getAngle2(r,e.trajectory.nextNodePos),e.trajectory.x=Math.cos(e.trajectory.angle),e.trajectory.y=-Math.sin(e.trajectory.angle),t.dir=l.getDireciton(e.trajectory.angle),t.movePos(e.trajectory.x,e.trajectory.y),e.moving=!0);else{var n=e.path.shift(),n={x:n.x*this.tileSize.width-this.tileSize.width/2,y:n.y*this.tileSize.height-this.tileSize.height/2};if(this.debugging){const e=VYLO.Map.getLocByPos(n.x,n.y,t.mapName),o=VYLO.newDiob();o.atlasName="",o.width=this.tileSize.width,o.height=this.tileSize.height,o.tint=23295,o.alpha=.8,o.plane=0,o.mouseOpacity=0,o.touchOpacity=0,o.setTransition({alpha:0},-1,debuggerDuration),e.addOverlay(o),setTimeout(()=>{e.removeOverlay(o)},debuggerDuration)}if(e.trajectory.angle=l.getAngle2(r,n),e.trajectory.nextNodePos=n,e.trajectory.x=Math.cos(e.trajectory.angle),e.trajectory.y=-Math.sin(e.trajectory.angle),t.dir=l.getDirection(e.trajectory.angle),"collision"===e.mode?t.movePos(e.trajectory.x,e.trajectory.y):"position"===e.mode&&t.setPos(e.trajectory.x,e.trajectory.y,t.mapName),e.moving=!0,this.debugging){const t=VYLO.newDiob();t.atlasName="",t.tint=16777215,t.width=this.tileSize.width,t.height=5,t.anchor=0,t.plane=0,t.mouseOpacity=0,t.touchOpacity=0,t.density=0,t.angle=e.trajectory.angle,t.setPos(r.x,r.y,self.mapName),t.setTransition({alpha:0},-1,debuggerDuration),setTimeout(()=>{VYLO.delDiob(t)},debuggerDuration)}}if(r.x===e.previousPosition.x&&r.y===e.previousPosition.y&&(e.stuckCounter++,e.stuckCounter>=b.MAX_STUCK_COUNTER)&&(this.end(t),"function"==typeof self.onPathStuck))return void self.onPathStuck();e.previousPosition=r}this.lastTime=i}}setTileSize(t){var e;"number"==typeof t?this.tileSize={width:t,height:t}:"object"==typeof t?(e=t.width,t=t.height,"number"==typeof e&&(this.tileSize.width=e),"number"==typeof t&&(this.tileSize.height=t)):this.logger.prefix("Pathway-Module").error("Invalid type used for pTileSize")}isTileInvalid(t){var e=t.density&&!ignoreList.includes(t),i=t.getContents().filter(t=>{if(t.density&&!ignoreList.includes(t))return t.density});return t&&(e||i.length)}async getPath(t,r){return new Promise(e=>{const i=this.easystar.findPath(t.x,t.y,r.x,r.y,t=>{Array.isArray(t)&&t.length?((t=t.map(t=>(++t.x,++t.y,t))).shift(),e({path:t,pathID:i})):Array.isArray(t)&&t.length||e({path:null,pathID:null})})})}toTwoDimensionalArray(t,e){let i=0;for(var r=[];i<t.length;)r.push(t.slice(i,i+=e));return r}tileToNode(t){if("string"==typeof t.mapName){if(b.storedMapTiles[t.mapName])return{x:(t=this.getIndexOf2DArray(b.storedMapTiles[t.mapName].tiles2d,t))[1],y:t[0]};this.logger.prefix("Pathway-Module").error("There is no stored grid for the map this tile belongs to.")}else this.logger.prefix("Pathway-Module").error("Invalid mapname found on pTile")}nodeToTile(t,e){return VYLO.Map.getLoc(e.x+1,e.y+1,t)}getIndexOf2DArray(e,i){for(let t=0;t<e.length;t++){var r=e[t].indexOf(i);if(-1<r)return[t,r]}}mapTilesToGrid(e,i){if("string"==typeof e)if(Array.isArray(i)){if(VYLO.Map.getMaps().includes(e)){let t;const r=[0],n=[],o=VYLO.Map.getMapSize(e);return b.storedMapTiles[e]?t=[...b.storedMapTiles[e].tiles]:(t=VYLO.Map.getTiles(e),b.storedMapTiles[e]={tiles:[...t],tiles2d:this.toTwoDimensionalArray([...t],o.x)}),t.map(t=>{let e="number"==typeof t.pathwayWeight?t.pathwayWeight:0;if(t.density||t.getContents().some(t=>t.density&&!i.includes(t)))e=b.NO_TRAVEL_WEIGHT;else for(const i of t.getContents())"number"==typeof i.pathwayWeight&&(e+=i.pathwayWeight);return e!==b.NO_TRAVEL_WEIGHT&&(r.includes(e)||r.push(e),n.includes(e)||n.push(e)),e}),{acceptedTiles:r,grid:this.toTwoDimensionalArray(t,o.x),weights:n}}this.logger.prefix("Pathway-Module").error("pMapName was not found in VYLO.")}else this.logger.prefix("Pathway-Module").error("Invalid type for pIgnoreList.");else this.logger.prefix("Pathway-Module").error("Invalid type for pMapName.")}}const w=new b;var v=e.Z;export{v as Pathway};