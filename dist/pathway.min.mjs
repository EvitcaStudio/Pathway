/**
 * pathway@1.0.0 https://github.com/EvitcaStudio/Pathway
 * Compiled 4/9/2024, 3:21:35 AM UTC
 * 
 * pathway is licensed under a MIT styled License. See LICENSE.md for more info.
 * 
 * Copyright 2024, Evitca Studio, All Rights Reserved
 */
 var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={},n=(t.d(e,{Z:()=>x}),{d:(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)}),o={},r=(n.d(o,{c:()=>h}),{d:(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)}),i={};r.d(i,{Y:()=>s});class s{constructor(t){this.RESET="[0m",this.BRIGHT="[1m",this.DIM="[2m",this.UNDERSCORE="[4m",this.BLINK="[5m",this.REVERSE="[7m",this.HIDDEN="[8m",this.FG_BLACK="[30m",this.FG_RED="[31m",this.FG_GREEN="[32m",this.FG_YELLOW="[33m",this.FG_BLUE="[34m",this.FG_MAGENTA="[35m",this.FG_CYAN="[36m",this.FG_WHITE="[37m",this.FG_GRAY="[90m",this.BG_BLACK="[40m",this.BG_RED="[41m",this.BG_GREEN="[42m",this.BG_YELLOW="[43m",this.BG_BLUE="[44m",this.BG_MAGENTA="[45m",this.BG_CYAN="[46m",this.BG_WHITE="[47m",this.BG_GRAY="[100m",this.TYPE_SPACER_LENGTH=13,this.types={default:this.FG_WHITE},this.currentType="",this.SPACE_CHAR=" ",this.FG_COLORS={};for(let t=0;t<=255;t++)this.FG_COLORS[t]="[38;5;"+t+"m";this.BG_COLORS={};for(let t=0;t<=255;t++)this.BG_COLORS[t]="[48;5;"+t+"m";Array.isArray(t)&&this.registerTypes(t)}prefix(t){return"string"==typeof t&&(this.currentType=t),this}message(e="log",...n){var r=this.currentType||"";if(0===r.length)console[e](...n);else{var o=r.length>=this.TYPE_SPACER_LENGTH;let t=this.types[r.toLowerCase()]?this.types[r.toLowerCase()]:this.types.default;var i=t.includes("");i||(t="color: "+t),!globalThis.window||i?console[e](t+r+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-r.length,o?1:0))+"|"+this.RESET,...n):console[e]("%c"+r+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-r.length,o?1:0))+"|",t,...n)}this.currentType=""}log(...t){this.message("log",...t)}info(...t){this.message("info",...t)}error(...t){this.message("error",...t)}warn(...t){this.message("warn",...t)}assert(...t){console.assert(...t)}debug(...t){this.message("debug",...t)}count(t){console.count(t)}countReset(t){console.countReset(t)}table(t,e){console.table(t,e)}time(t){this.message("time",t)}timeLog(t){this.message("timeLog",t)}timeEnd(t){this.message("timeEnd",t)}trace(...t){this.message("trace",...t)}group(t){this.message("group",t)}groupCollapsed(t){console.groupCollapsed(t)}groupEnd(){console.groupEnd()}clear(){console.clear()}registerType(t,e){this.types[t]||"string"==typeof t&&"string"==typeof e&&(this.types[t.toLowerCase()]=e)}registerTypes(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.registerType(e[t].type,e[t].ansi)}unregisterType(t){this.types[t]&&delete this.types[t]}}var a=i.Y;const h=new class{transitions={};storedIDs=[];version="1.0.0";constructor(){this.logger=new a,this.logger.registerType("Utils-Module","#ff6600")}decimalRand(t,e,n=1){return Number((Math.random()*(t-e)+e).toFixed(n))}rand(t,e){return t=Number(Math.random()*(t-e)+e),Math.round(t)}getPercentage(t,e){return 100*t/e}clamp(t,e=0,n=1){return Math.max(e,Math.min(t,n))}lerp(t,e,n){return(1-n)*t+n*e}flooredLerp(t,e,n){return Math.floor(this.lerp(t,e,n))}round(t,e=1){return Math.round(e*t)/e}normalize(t,e,n){return n-e==0?1:(t-e)/(n-e)}normalizeRanged(t,e,n){return n-e==0?1:(t=-(2*this.normalize(t,e,n)-1),this.clamp(t,-1,1))}within(t,e,n){return e<=t&&t<=n}formatIntegerWithCommas(t){return t.toFixed().toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}toRadians(t){return t*(Math.PI/180)}toDegrees(t){return t*(180/Math.PI)}pick(t){return t[Math.floor(Math.random()*t.length)]}removeProperties(t,e){if("object"==typeof t)for(const n in t)Array.isArray(e)&&e.includes(n)||t.hasOwnProperty(n)&&delete t[n]}prob(t){return!(t<=0)&&(100<=t||Math.floor(100*Math.random())+1<=t)}getInverseDirection(t){switch(t){case"north":return"south";case"south":return"north";case"east":return"west";case"west":return"east";case"northeast":return"southwest";case"northwest":return"southeast";case"southeast":return"northwest";case"southwest":return"northeast";default:this.logger.prefix("Utils-Module").error(`The direction ${t} is not supported.`)}}getAngleFromDirection(t){switch(t){case"north":return Math.PI/2;case"south":return 3*Math.PI/2;case"east":return 0;case"west":return Math.PI;case"northwest":return 3*Math.PI/4;case"northeast":return Math.PI/4;case"southwest":return 5*Math.PI/4;case"southeast":return 7*Math.PI/4;default:this.logger.prefix("Utils-Module").error(`The direction ${t} is not supported.`)}}centerRectangleOnParent(t,e,n,r,o,i){return{x:o+(n-t)/2,y:i+(r-e)/2}}getRandomAngle(){return Math.random()*(2*Math.PI)}getAngle(t,e){var n=t.y-e.y;return t=t.x-e.x,Math.atan2(n,t)}getAngle2(t,e){var n=t.y-e.y;return t=t.x-e.x,-1*(Math.atan2(n,t)-Math.PI)}convertRaWAngleToVyloCoords(t){return-1*(t-Math.PI)}getDistance(t,e){var n=t.y-e.y;return t=t.x-e.x,Math.sqrt(t*t+n*n)}calculateNewPositionFromDistanceAndAngle(t,e,n){var r={x:0,y:0};return r.x=t.x-e*Math.cos(n),r.y=t.y-e*Math.sin(n),r}calculateProportionalLength(t,e,n){return t/e*n}getDirection(t){return["east","northeast","north","northwest","west","southwest","south","southeast"][Math.abs(Math.floor(t*(180/Math.PI)/45+.5))%8]}linearDecay(t,e,n,r=.5){return Math.max(t*(1-e/n*r),1)}generateID(n=7){function t(){let e="";for(let t=0;t<n;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}let e=t();for(;this.storedIDs.includes(e);)e=t();return this.storedIDs.push(e),e}decimalToHex(t,e=6){return"#"+(t+Math.pow(16,e)).toString(16).slice(-e).toUpperCase()}addIntensity(t,e){var n=(t=this.grabColor(t).rgbArray)[0],r=t[1];t=t[2];let o=0,i=0,s=0;var a=0===n&&0===r&&0===t;return(n||a)&&(o=n+Math.floor(255*e/100)),(r||a)&&(i=r+Math.floor(255*e/100)),(t||a)&&(s=t+Math.floor(255*e/100)),this.grabColor(this.clamp(o,0,255),this.clamp(i,0,255),this.clamp(s,0,255)).hex}rgbToHex(t,e,n){return"#"+[this.clamp(t,0,255),this.clamp(e,0,255),this.clamp(n,0,255)].map(function(t){return t.toString(16).padStart(2,"0")}).join("")}hexToRgb(t){return t=(t=3===(t=t.replace("#","")).length?t.replace(new RegExp("(.)","g"),"$1$1"):t).match(new RegExp("..","g")),[this.clamp(parseInt(t[0],16),0,255),this.clamp(parseInt(t[1],16),0,255),this.clamp(parseInt(t[2],16),0,255)]}rgbToDecimal(t,e,n){return t<<16|e<<8|n}hexToDecimal(t){return t=t.replace("#",""),parseInt(t,16)}grabColor(t=this.getRandomColor(),e,n){let r,o;return"number"==typeof t&&"number"==typeof e&&"number"==typeof n?r=this.rgbToHex(t,e,n):("number"==typeof t&&(t=this.decimalToHex(t)),r=t,o=this.hexToRgb(r)),{hex:r.toLowerCase(),hexTagless:r.replace("#","").toLowerCase(),rgb:"rgb("+o[0]+","+o[1]+","+o[2]+")",rgbArray:o,rgbObject:{r:o[0],g:o[1],b:o[2]},rgbNormal:[Math.round(o[0]/255*100)/100,Math.round(o[1]/255*100)/100,Math.round(o[2]/255*100)/100],decimal:this.hexToDecimal(r)}}getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}getRandomColorBetween(t,e,n=.5){return this.flooredLerp(this.grabColor(t).decimal,this.grabColor(e).decimal,n)}transitionColor(h,t="#000",e="#fff",l=1e3,n,r){if(globalThis.window){const c="function"==typeof n?n:null,u="function"==typeof r?r:null;let i,s,a;h?(i=h.id||this.generateID(),s="GeneratedParticle"===h.type,a="object"==typeof h.color&&h.color.constructor===Object,this.transitions[i]&&this.cancelTransitionColor(i)):i=this.generateID(),this.transitions[i]={duration:l,timeTracker:s?h.info.lifetime:0};const p=this.grabColor(t).rgbArray,y=this.grabColor(e).rgbArray,d=this;return this.transitions[i].step=t=>{if(d.transitions[i]){if(s){if(!h.info)return void(d.transitions[i]&&this.cancelTransitionColor(i));if(h.info.owner&&h.info.owner.settings.paused)return}d.transitions[i].lastTime||(d.transitions[i].lastTime=t);var e=t-d.transitions[i].lastTime,n=(d.transitions[i].timeTracker+=e,e=Math.min(d.transitions[i].timeTracker/d.transitions[i].duration,1),parseInt(d.lerp(p[0],y[0],e),10)),r=parseInt(d.lerp(p[1],y[1],e),10),o=parseInt(d.lerp(p[2],y[2],e),10),n=d.grabColor(n,r,o);c&&c(n),h&&(a?(h.color.tint=n.decimal,h.color=h.color):h.color=n.hex),1<=e||d.transitions[i].timeTracker>=l?(d.transitions[i]&&this.cancelTransitionColor(i),u&&u(n)):(d.transitions[i].req=globalThis.requestAnimationFrame(d.transitions[i].step),d.transitions[i].lastTime=t)}},this.transitions[i].req=globalThis.requestAnimationFrame(this.transitions[i].step),i}}cancelTransitionColor(t){this.transitions[t]&&(globalThis.cancelAnimationFrame(this.transitions[t].req),delete this.transitions[t])}getPointRotated(t,e,n){var r=t.x+t.width*("object"==typeof t.anchor&&t.anchor.x?t.anchor.x:.5),o=(t=t.y+t.height*("object"==typeof t.anchor&&t.anchor.y?t.anchor.y:.5),n.x-r);return n=n.y-t,{x:o*Math.cos(e)-n*-Math.sin(e)+r,y:o*-Math.sin(e)+n*Math.cos(e)+t}}getPointsOfRotatedRect(t,e){return{tl:this.getPointRotated(t,e,{x:t.x,y:t.y}),tr:this.getPointRotated(t,e,{x:t.x+t.width,y:t.y}),bl:this.getPointRotated(t,e,{x:t.x,y:t.y+t.height}),br:this.getPointRotated(t,e,{x:t.x+t.width,y:t.y+t.height}),center:this.getPointRotated(t,e,{x:t.x+t.width/2,y:t.y+t.height/2})}}calculateIconOffset(t={width:32,height:32},e={x:.5,y:.5},n={x:1,y:1}){var r=t.width*n.x,n=t.height*n.y;return{x:e.x*(r-t.width),y:e.y*(n-t.height)}}};var l=o.c,c={d:(t,e)=>{for(var n in e)c.o(e,n)&&!c.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},u={};c.d(u,{Y:()=>p});class p{constructor(t){this.RESET="[0m",this.BRIGHT="[1m",this.DIM="[2m",this.UNDERSCORE="[4m",this.BLINK="[5m",this.REVERSE="[7m",this.HIDDEN="[8m",this.FG_BLACK="[30m",this.FG_RED="[31m",this.FG_GREEN="[32m",this.FG_YELLOW="[33m",this.FG_BLUE="[34m",this.FG_MAGENTA="[35m",this.FG_CYAN="[36m",this.FG_WHITE="[37m",this.FG_GRAY="[90m",this.BG_BLACK="[40m",this.BG_RED="[41m",this.BG_GREEN="[42m",this.BG_YELLOW="[43m",this.BG_BLUE="[44m",this.BG_MAGENTA="[45m",this.BG_CYAN="[46m",this.BG_WHITE="[47m",this.BG_GRAY="[100m",this.TYPE_SPACER_LENGTH=13,this.types={default:this.FG_WHITE},this.currentType="",this.SPACE_CHAR=" ",this.FG_COLORS={};for(let t=0;t<=255;t++)this.FG_COLORS[t]="[38;5;"+t+"m";this.BG_COLORS={};for(let t=0;t<=255;t++)this.BG_COLORS[t]="[48;5;"+t+"m";Array.isArray(t)&&this.registerTypes(t)}prefix(t){return"string"==typeof t&&(this.currentType=t),this}message(e="log",...n){var r=this.currentType||"";if(0===r.length)console[e](...n);else{var o=r.length>=this.TYPE_SPACER_LENGTH;let t=this.types[r.toLowerCase()]?this.types[r.toLowerCase()]:this.types.default;var i=t.includes("");i||(t="color: "+t),!globalThis.window||i?console[e](t+r+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-r.length,o?1:0))+"|"+this.RESET,...n):console[e]("%c"+r+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-r.length,o?1:0))+"|",t,...n)}this.currentType=""}log(...t){this.message("log",...t)}info(...t){this.message("info",...t)}error(...t){this.message("error",...t)}warn(...t){this.message("warn",...t)}assert(...t){console.assert(...t)}debug(...t){this.message("debug",...t)}count(t){console.count(t)}countReset(t){console.countReset(t)}table(t,e){console.table(t,e)}time(t){this.message("time",t)}timeLog(t){this.message("timeLog",t)}timeEnd(t){this.message("timeEnd",t)}trace(...t){this.message("trace",...t)}group(t){this.message("group",t)}groupCollapsed(t){console.groupCollapsed(t)}groupEnd(){console.groupEnd()}clear(){console.clear()}registerType(t,e){this.types[t]||"string"==typeof t&&"string"==typeof e&&(this.types[t.toLowerCase()]=e)}registerTypes(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.registerType(e[t].type,e[t].ansi)}unregisterType(t){this.types[t]&&delete this.types[t]}}var d=u.Y;function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var y={731:function(t,e,n){t.exports=n(297)},297:function(a,m){var T,E;!function(){var t,p,h,y,d,e,l,n,f,g,r,o,i,c,u;function s(t){this.cmp=null!=t?t:p,this.nodes=[]}h=Math.floor,g=Math.min,p=function(t,e){return t<e?-1:e<t?1:0},f=function(t,e,n,r,o){var i;if(null==o&&(o=p),(n=null==n?0:n)<0)throw new Error("lo must be non-negative");for(null==r&&(r=t.length);n<r;)o(e,t[i=h((n+r)/2)])<0?r=i:n=i+1;return[].splice.apply(t,[n,n-n].concat(e)),e},d=function(t,e){var n,r;return null==e&&(e=p),n=t.pop(),t.length?(r=t[0],t[0]=n,u(t,0,e)):r=n,r},n=function(t,e,n){var r;return null==n&&(n=p),r=t[0],t[0]=e,u(t,0,n),r},l=function(t,e,n){var r;return null==n&&(n=p),t.length&&n(t[0],e)<0&&(e=(r=[t[0],e])[0],t[0]=r[1],u(t,0,n)),e},y=function(n,t){var e,r,o,i,s,a;for(null==t&&(t=p),s=[],r=0,o=(i=function(){a=[];for(var t=0,e=h(n.length/2);0<=e?t<e:e<t;0<=e?t++:t--)a.push(t);return a}.apply(this).reverse()).length;r<o;r++)e=i[r],s.push(u(n,e,t));return s},i=function(t,e,n){if(null==n&&(n=p),-1!==(e=t.indexOf(e)))return c(t,0,e,n),u(t,e,n)},r=function(t,e,n){var r,o,i,s,a;if(null==n&&(n=p),!(o=t.slice(0,e)).length)return o;for(y(o,n),i=0,s=(a=t.slice(e)).length;i<s;i++)r=a[i],l(o,r,n);return o.sort(n).reverse()},o=function(t,e,n){var r,o,i,s,a,h,l,c,u;if(null==n&&(n=p),10*e<=t.length){if((i=t.slice(0,e).sort(n)).length)for(o=i[i.length-1],s=0,h=(l=t.slice(e)).length;s<h;s++)n(r=l[s],o)<0&&(f(i,r,0,null,n),i.pop(),o=i[i.length-1]);return i}for(y(t,n),u=[],a=0,c=g(e,t.length);0<=c?a<c:c<a;0<=c?++a:--a)u.push(d(t,n));return u},c=function(t,e,n,r){var o,i,s;for(null==r&&(r=p),o=t[n];e<n&&r(o,i=t[s=n-1>>1])<0;)t[n]=i,n=s;return t[n]=o},u=function(t,e,n){var r,o,i,s,a;for(null==n&&(n=p),o=t.length,i=t[a=e],r=2*e+1;r<o;)(s=r+1)<o&&!(n(t[r],t[s])<0)&&(r=s),t[e]=t[r],r=2*(e=r)+1;return t[e]=i,c(t,a,e,n)},s.push=e=function(t,e,n){return null==n&&(n=p),t.push(e),c(t,0,t.length-1,n)},s.pop=d,s.replace=n,s.pushpop=l,s.heapify=y,s.updateItem=i,s.nlargest=r,s.nsmallest=o,s.prototype.push=function(t){return e(this.nodes,t,this.cmp)},s.prototype.pop=function(){return d(this.nodes,this.cmp)},s.prototype.peek=function(){return this.nodes[0]},s.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},s.prototype.replace=function(t){return n(this.nodes,t,this.cmp)},s.prototype.pushpop=function(t){return l(this.nodes,t,this.cmp)},s.prototype.heapify=function(){return y(this.nodes,this.cmp)},s.prototype.updateItem=function(t){return i(this.nodes,t,this.cmp)},s.prototype.clear=function(){return this.nodes=[]},s.prototype.empty=function(){return 0===this.nodes.length},s.prototype.size=function(){return this.nodes.length},s.prototype.clone=function(){var t=new s;return t.nodes=this.nodes.slice(0),t},s.prototype.toArray=function(){return this.nodes.slice(0)},s.prototype.insert=s.prototype.push,s.prototype.top=s.prototype.peek,s.prototype.front=s.prototype.peek,s.prototype.has=s.prototype.contains,s.prototype.copy=s.prototype.clone,t=s,E=[],void 0!==(E="function"==typeof(T=function(){return t})?T.apply(m,E):T)&&(a.exports=E)}.call(this)}},g={};function m(t){var e=g[t];return void 0===e&&(e=g[t]={exports:{}},y[t].call(e.exports,e,e.exports,m)),e.exports}m.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return m.d(e,{a:e}),e},m.d=function(t,e){for(var n in e)m.o(e,n)&&!m.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},m.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var T={},P=(function(){m.d(T,{x:function(){return n}});t=function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},Object.defineProperty(t,"prototype",{writable:!1});var v=t;function s(t){return(s="function"==typeof Symbol&&"symbol"==f(Symbol.iterator)?function(t){return f(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":f(t)})(t)}var M=function(){for(var t,e,e=function t(e,n,r,o,i){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.parent=e,this.x=n,this.y=r,this.costSoFar=o,this.simpleDistanceToTarget=i},n=e.prototype,r=[{key:"bestGuessDistance",value:function(){return this.costSoFar+this.simpleDistanceToTarget}}],o=0;o<r.length;o++){var i=r[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,(t=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return String(t);if("object"!=s(e=e.call(t,"string")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(i.key),"symbol"==s(t)?t:t+""),i)}return Object.defineProperty(e,"prototype",{writable:!1}),e}(),t=m(731),b=m.n(t),n={},A=1;n.js=function(){var c,i,u,p=!1,s={},r={},o={},h={},a=!0,y={},d=[],l=Number.MAX_VALUE,f=!1,g=(this.setAcceptableTiles=function(t){t instanceof Array?u=t:!isNaN(parseFloat(t))&&isFinite(t)&&(u=[t])},this.enableSync=function(){p=!0},this.disableSync=function(){p=!1},this.enableDiagonals=function(){f=!0},this.disableDiagonals=function(){f=!1},this.setGrid=function(t){c=t;for(var e=0;e<c.length;e++)for(var n=0;n<c[0].length;n++)r[c[e][n]]||(r[c[e][n]]=1)},this.setTileCost=function(t,e){r[t]=e},this.setAdditionalPointCost=function(t,e,n){void 0===o[e]&&(o[e]={}),o[e][t]=n},this.removeAdditionalPointCost=function(t,e){void 0!==o[e]&&delete o[e][t]},this.removeAllAdditionalPointCosts=function(){o={}},this.setDirectionalCondition=function(t,e,n){void 0===h[e]&&(h[e]={}),h[e][t]=n},this.removeAllDirectionalConditions=function(){h={}},this.setIterationsPerCalculation=function(t){l=t},this.avoidAdditionalPoint=function(t,e){void 0===s[e]&&(s[e]={}),s[e][t]=1},this.stopAvoidingAdditionalPoint=function(t,e){void 0!==s[e]&&delete s[e][t]},this.enableCornerCutting=function(){a=!0},this.disableCornerCutting=function(){a=!1},this.stopAvoidingAllAdditionalPoints=function(){s={}},this.findPath=function(t,e,n,r,o){function i(t){p?o(t):setTimeout(function(){o(t)})}if(void 0===u)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===c)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(t<0||e<0||n<0||r<0||t>c[0].length-1||e>c.length-1||n>c[0].length-1||r>c.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(t===n&&e===r)i([]);else{for(var s,a=c[r][n],h=!1,l=0;l<u.length;l++)if(a===u[l]){h=!0;break}if(!1!==h)return(s=new v).openList=new(b())(function(t,e){return t.bestGuessDistance()-e.bestGuessDistance()}),s.isDoneCalculating=!1,s.nodeHash={},s.startX=t,s.startY=e,s.endX=n,s.endY=r,s.callback=i,s.openList.push(P(s,s.startX,s.startY,null,1)),t=A++,y[t]=s,d.push(t),t;i(null)}},this.cancelPath=function(t){return t in y&&(delete y[t],!0)},this.calculate=function(){if(0!==d.length&&void 0!==c&&void 0!==u)for(i=0;i<l;i++){if(0===d.length)return;p&&(i=0);var t=d[0],e=y[t];if(void 0===e)d.shift();else if(0===e.openList.size())e.callback(null),delete y[t],d.shift();else{var n=e.openList.pop();if(e.endX===n.x&&e.endY===n.y){for(var r=[],o=(r.push({x:n.x,y:n.y}),n.parent);null!=o;)r.push({x:o.x,y:o.y}),o=o.parent;r.reverse(),e.callback(r),delete y[t],d.shift()}else(n.list=0)<n.y&&g(e,n,0,-1,+E(n.x,n.y-1)),n.x<c[0].length-1&&g(e,n,1,0,+E(n.x+1,n.y)),n.y<c.length-1&&g(e,n,0,1,+E(n.x,n.y+1)),0<n.x&&g(e,n,-1,0,+E(n.x-1,n.y)),f&&(0<n.x&&0<n.y&&(a||m(c,u,n.x,n.y-1,n)&&m(c,u,n.x-1,n.y,n))&&g(e,n,-1,-1,1.4*E(n.x-1,n.y-1)),n.x<c[0].length-1&&n.y<c.length-1&&(a||m(c,u,n.x,n.y+1,n)&&m(c,u,n.x+1,n.y,n))&&g(e,n,1,1,1.4*E(n.x+1,n.y+1)),n.x<c[0].length-1&&0<n.y&&(a||m(c,u,n.x,n.y-1,n)&&m(c,u,n.x+1,n.y,n))&&g(e,n,1,-1,1.4*E(n.x+1,n.y-1)),0<n.x)&&n.y<c.length-1&&(a||m(c,u,n.x,n.y+1,n)&&m(c,u,n.x-1,n.y,n))&&g(e,n,-1,1,1.4*E(n.x-1,n.y+1))}}},function(t,e,n,r,o){n=e.x+n,r=e.y+r,void 0!==s[r]&&void 0!==s[r][n]||!m(c,u,n,r,e)||(void 0===(n=P(t,n,r,e,o)).list?(n.list=1,t.openList.push(n)):e.costSoFar+o<n.costSoFar&&(n.costSoFar=e.costSoFar+o,n.parent=e,t.openList.updateItem(n)))}),m=function(t,e,n,r,o){var i=h[r]&&h[r][n];if(i){var s=T(o.x-n,o.y-r);if(!function(){for(var t=0;t<i.length;t++)if(i[t]===s)return 1}())return!1}for(var a=0;a<e.length;a++)if(t[r][n]===e[a])return!0;return!1},T=function(t,e){if(0===t&&-1===e)return n.TOP;if(1===t&&-1===e)return n.TOP_RIGHT;if(1===t&&0===e)return n.RIGHT;if(1===t&&1===e)return n.BOTTOM_RIGHT;if(0===t&&1===e)return n.BOTTOM;if(-1===t&&1===e)return n.BOTTOM_LEFT;if(-1===t&&0===e)return n.LEFT;if(-1===t&&-1===e)return n.TOP_LEFT;throw new Error("These differences are not valid: "+t+", "+e)},E=function(t,e){return o[e]&&o[e][t]||r[c[e][t]]},P=function(t,e,n,r,o){if(void 0!==t.nodeHash[n]){if(void 0!==t.nodeHash[n][e])return t.nodeHash[n][e]}else t.nodeHash[n]={};var i=x(e,n,t.endX,t.endY);return o=null!==r?r.costSoFar+o:0,r=new M(r,e,n,o,i),t.nodeHash[n][e]=r},x=function(t,e,n,r){var o,i;return f?(o=Math.abs(t-n))<(i=Math.abs(e-r))?1.4*o+i:1.4*i+o:(o=Math.abs(t-n))+Math.abs(e-r)}},n.TOP="TOP",n.TOP_RIGHT="TOP_RIGHT",n.RIGHT="RIGHT",n.BOTTOM_RIGHT="BOTTOM_RIGHT",n.BOTTOM="BOTTOM",n.BOTTOM_LEFT="BOTTOM_LEFT",n.LEFT="LEFT",n.TOP_LEFT="TOP_LEFT"}(),T.x);class E{static MAX_STUCK_COUNTER=100;static MAX_DELTA_TIME=.03333333333;static AVERSION_WEIGHT=10;static PASSABLE_WEIGHT=0;static NO_TRAVEL_WEIGHT=-1;static DEFAULT_PIXELS_PER_SECOND=120;static DEFAULT_MINIMUM_DISTANCE=2;static DEFAULT_MODE="collision";static storedMapTiles={};static DEFAULT_TILE_SIZE={width:32,height:32};tileSize={...E.DEFAULT_TILE_SIZE};version="1.0.0";instanceWeakMap=new WeakMap;lastTime=0;deltaTime=0;elapsedMS=0;activeInstances=[];constructor(){this.logger=new d,this.logger.registerType("Pathway-Module","#ff6600")}async to(t,n,r){if("object"==typeof t)if(t.mapName)if("object"!=typeof n)this.logger.prefix("Pathway-Module").error("Invalid type passed for pDestination. Expecting an object.");else{let e=this.instanceWeakMap.get(t);e?this.end(t):((e={trajectory:{angle:0,x:0,y:0,nextNodePos:null},currentPosition:{x:0,y:0},previousPosition:{x:0,y:0},stuckCounter:0,maxStuckCounter:E.MAX_STUCK_COUNTER,pathID:null,path:[],moving:null,mode:E.DEFAULT_MODE,pixelsPerSecond:E.DEFAULT_PIXELS_PER_SECOND,minDistance:E.DEFAULT_MINIMUM_DISTANCE,events:{onPathStuck:null,onPathComplete:null,onPathFound:null,onPathNotFound:null},easystar:new P.js}).easystar.setIterationsPerCalculation(1e3),this.instanceWeakMap.set(t,e));var o=[];if("object"==typeof r){if("number"==typeof r.maxStuckCounter&&(e.maxStuckCounter=r.maxStuckCounter),r.diagonal&&(e.easystar.enableDiagonals(),e.easystar.enableCornerCutting()),r.mode){const t="collision"===r.mode||"position"===r.mode?r.mode:E.DEFAULT_MODE;e.mode=t}"number"==typeof r.pixelsPerSecond&&(e.pixelsPerSecond=r.pixelsPerSecond),"number"==typeof r.minDistance&&(e.minDistance=r.minDistance),"function"==typeof r.onPathComplete&&(e.events.onPathComplete=r.onPathComplete),"function"==typeof r.onPathFound&&(e.events.onPathFound=r.onPathFound),"function"==typeof r.onPathNotFound&&(e.events.onPathNotFound=r.onPathNotFound),"function"==typeof r.onPathStuck&&(e.events.onPathStuck=r.onPathStuck),Array.isArray(r.ignore)&&o.push(...r.ignore)}var r=this.getPositionFromInstance(t),r=VYLO.Map.getLocByPos(r.x,r.y,t.mapName),i=(o.includes(r)||o.push(r),o.includes(t)||o.push(t),this.mapTilesToGrid(t.mapName,o)),i=(e.easystar.setGrid(i.grid),i.weights.forEach(t=>{e.easystar.setTileCost(t,t)}),e.easystar.setAcceptableTiles(i.acceptedTiles),VYLO.Map.getMapSize(t.mapName)),s=l.clamp(l.clamp(n.x,0,i.x)*this.tileSize.width+this.tileSize.width/2,0,i.xPos-this.tileSize.width),n=l.clamp(l.clamp(n.y,0,i.y)*this.tileSize.height+this.tileSize.height/2,0,i.yPos-this.tileSize.height),i=VYLO.Map.getLocByPos(s,n,t.mapName),s=this.tileToNode(r),n=this.tileToNode(i);this.isTileInvalid(r,o)||this.isTileInvalid(i,o)?("function"==typeof e.events.onPathNotFound&&e.events.onPathNotFound(),this.end(t)):this.getPath(t,{x:s.x,y:s.y},{x:n.x,y:n.y})}else this.logger.prefix("Pathway-Module").error("Cannot generate a path. pInstance is not on a map.");else this.logger.prefix("Pathway-Module").error("Invalid type passed for pInstance. Expecting an object.")}track(t){this.activeInstances.includes(t)||this.activeInstances.push(t)}untrack(t){this.activeInstances.includes(t)&&this.activeInstances.splice(this.activeInstances.indexOf(t),1)}end(t){var e=this.instanceWeakMap.get(t);e?(e.pathID&&(e.easystar.cancelPath(e.pathID),e.pathID=null),e.easystar.disableDiagonals(),e.easystar.disableCornerCutting(),e.trajectory.x=0,e.trajectory.y=0,e.trajectory.angle=0,e.trajectory.nextNodePos=null,e.events.onPathStuck=null,e.events.onPathComplete=null,e.events.onPathFound=null,e.events.onPathNotFound=null,e.stuckCounter=0,e.maxStuckCounter=E.MAX_STUCK_COUNTER,e.path.length=0,e.moving=!1,e.mode="collision",e.pixelsPerSecond=E.DEFAULT_PIXELS_PER_SECOND,e.minDistance=E.DEFAULT_MINIMUM_DISTANCE,t.move(),this.untrack(t)):this.logger.prefix("Pathway-Module").error("No instance data found from pInstance. This instance is not engaged in pathfinding.")}getPositionFromInstance(t){var e=this.instanceWeakMap.get(t);if(e)return e.currentPosition.x=Math.floor(t.x+t.xOrigin+t.width/2),e.currentPosition.y=Math.floor(t.y+t.yOrigin+t.height/2),e.currentPosition}update(){var t=Date.now();this.elapsedMS=t-this.lastTime,this.deltaTime=this.elapsedMS/1e3,this.deltaTime>=E.MAX_DELTA_TIME&&(this.deltaTime=E.MAX_DELTA_TIME),this.activeInstances.forEach(t=>{var e,n,r=this.instanceWeakMap.get(t);r&&(r.easystar.calculate(),Array.isArray(r.path))&&(r.path.length||r.moving)&&(e=this.getPositionFromInstance(t),r.moving?l.getDistance(e,r.trajectory.nextNodePos)<=r.minDistance?(r.moving=!1,r.stuckCounter=0,r.path.length||("function"==typeof r.events.onPathComplete&&r.events.onPathComplete(),this.end(t))):(r.trajectory.angle=l.getAngle2(e,r.trajectory.nextNodePos),r.trajectory.x=Math.cos(r.trajectory.angle),r.trajectory.y=-Math.sin(r.trajectory.angle),t.dir=l.getDirection(r.trajectory.angle),"collision"===r.mode?t.movePos(r.trajectory.x,r.trajectory.y):"position"===r.mode&&(n=r.pixelsPerSecond*this.deltaTime,t.setPos(t.x+n*r.trajectory.x,t.y+n*r.trajectory.y,t.mapName)),r.moving=!0):(n={x:(n=r.path.shift()).x*this.tileSize.width-this.tileSize.width/2,y:n.y*this.tileSize.height-this.tileSize.height/2},r.trajectory.nextNodePos=n,r.trajectory.angle=l.getAngle2(e,r.trajectory.nextNodePos),r.trajectory.x=Math.cos(r.trajectory.angle),r.trajectory.y=-Math.sin(r.trajectory.angle),t.dir=l.getDirection(r.trajectory.angle),"collision"===r.mode?t.movePos(r.trajectory.x,r.trajectory.y):"position"===r.mode&&(n=r.pixelsPerSecond*this.deltaTime,t.setPos(t.x+n*r.trajectory.x,t.y+n*r.trajectory.y,t.mapName)),r.moving=!0),e.x===r.previousPosition.x&&e.y===r.previousPosition.y&&(r.stuckCounter++,r.stuckCounter>=r.maxStuckCounter)?("function"==typeof r.events.onPathStuck&&r.events.onPathStuck(),this.end(t)):r.previousPosition=e)}),this.lastTime=t}setTileSize(t){var e;"number"==typeof t?this.tileSize={width:t,height:t}:"object"==typeof t?(e=t.width,t=t.height,"number"==typeof e&&(this.tileSize.width=e),"number"==typeof t&&(this.tileSize.height=t)):this.logger.prefix("Pathway-Module").error("Invalid type used for pTileSize")}isTileInvalid(t,e){var n=t.density&&!e.includes(t),t=t.getContents().some(t=>t.density&&!t.pathwayWeight&&!e.includes(t));return n||t}getPath(o,i,s){return new Promise((t,e)=>{const n=this.instanceWeakMap.get(o);if(n){let e;const r=n.easystar.findPath(i.x,i.y,s.x,s.y,t=>{Array.isArray(t)&&t.length?((e=t.map(t=>({x:++t.x,y:++t.y}))).shift(),n.path=e,n.pathID=r,"function"==typeof n.events.onPathFound&&n.events.onPathFound(e)):("function"==typeof n.events.onPathNotFound&&n.events.onPathNotFound(),this.end(o))});this.track(o)}else this.logger.prefix("Pathway-Module").error("Instance data not found!"),e()})}toTwoDimensionalArray(t,e){let n=0;for(var r=[];n<t.length;)r.push(t.slice(n,n+=e));return r}tileToNode(t){if("string"==typeof t.mapName){if(E.storedMapTiles[t.mapName])return{x:(t=this.getIndexOf2DArray(E.storedMapTiles[t.mapName].tiles2d,t))[1],y:t[0]};this.logger.prefix("Pathway-Module").error("There is no stored grid for the map this tile belongs to.")}else this.logger.prefix("Pathway-Module").error("Invalid mapname found on pTile")}getIndexOf2DArray(e,n){for(let t=0;t<e.length;t++){var r=e[t].indexOf(n);if(-1<r)return[t,r]}}mapTilesToGrid(e,n){if("string"==typeof e)if(Array.isArray(n)){if(VYLO.Map.getMaps().includes(e)){let t;const r=[0],o=[],i=VYLO.Map.getMapSize(e);E.storedMapTiles[e]?t=E.storedMapTiles[e].tiles:(t=VYLO.Map.getTiles(e),E.storedMapTiles[e]={tiles:t,tiles2d:this.toTwoDimensionalArray(t,i.x)});e=t.map(t=>{let e="number"==typeof t.pathwayWeight?t.pathwayWeight:E.PASSABLE_WEIGHT;if(t.density||t.getContents().some(t=>t.density&&!t.pathwayWeight&&!n.includes(t)))e=E.NO_TRAVEL_WEIGHT;else for(const n of t.getContents())"number"==typeof n.pathwayWeight&&(e+=n.pathwayWeight);return e!==E.NO_TRAVEL_WEIGHT&&e!==E.PASSABLE_WEIGHT&&(r.includes(e)||r.push(e),o.includes(e)||o.push(e)),e});return{acceptedTiles:r,grid:this.toTwoDimensionalArray(e,i.x),weights:o}}this.logger.prefix("Pathway-Module").error("pMapName was not found in VYLO.")}else this.logger.prefix("Pathway-Module").error("Invalid type for pIgnoreList.");else this.logger.prefix("Pathway-Module").error("Invalid type for pMapName.")}}const x=new E,v="undefined"==typeof window,M=x.update.bind(x);if(v)setInterval(M,16);else{const t=()=>{M(),requestAnimationFrame(t)};requestAnimationFrame(t)}var b=e.Z;export{b as Pathway};