/**
 * pathway@1.0.0 https://github.com/EvitcaStudio/Pathway
 * Compiled 4/7/2024, 9:44:55 AM UTC
 * 
 * pathway is licensed under a MIT styled License. See LICENSE.md for more info.
 * 
 * Copyright 2024, Evitca Studio, All Rights Reserved
 */
 var t={d:(e,i)=>{for(var o in i)t.o(i,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:i[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={},i=(t.d(e,{Z:()=>v}),{d:(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)}),n={},o=(i.d(n,{c:()=>h}),{d:(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)}),r={};o.d(r,{Y:()=>s});class s{constructor(t){this.RESET="[0m",this.BRIGHT="[1m",this.DIM="[2m",this.UNDERSCORE="[4m",this.BLINK="[5m",this.REVERSE="[7m",this.HIDDEN="[8m",this.FG_BLACK="[30m",this.FG_RED="[31m",this.FG_GREEN="[32m",this.FG_YELLOW="[33m",this.FG_BLUE="[34m",this.FG_MAGENTA="[35m",this.FG_CYAN="[36m",this.FG_WHITE="[37m",this.FG_GRAY="[90m",this.BG_BLACK="[40m",this.BG_RED="[41m",this.BG_GREEN="[42m",this.BG_YELLOW="[43m",this.BG_BLUE="[44m",this.BG_MAGENTA="[45m",this.BG_CYAN="[46m",this.BG_WHITE="[47m",this.BG_GRAY="[100m",this.TYPE_SPACER_LENGTH=13,this.types={default:this.FG_WHITE},this.currentType="",this.SPACE_CHAR=" ",this.FG_COLORS={};for(let t=0;t<=255;t++)this.FG_COLORS[t]="[38;5;"+t+"m";this.BG_COLORS={};for(let t=0;t<=255;t++)this.BG_COLORS[t]="[48;5;"+t+"m";Array.isArray(t)&&this.registerTypes(t)}prefix(t){return"string"==typeof t&&(this.currentType=t),this}message(e="log",...i){var o=this.currentType||"";if(0===o.length)console[e](...i);else{var n=o.length>=this.TYPE_SPACER_LENGTH;let t=this.types[o.toLowerCase()]?this.types[o.toLowerCase()]:this.types.default;var r=t.includes("");r||(t="color: "+t),!globalThis.window||r?console[e](t+o+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-o.length,n?1:0))+"|"+this.RESET,...i):console[e]("%c"+o+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-o.length,n?1:0))+"|",t,...i)}this.currentType=""}log(...t){this.message("log",...t)}info(...t){this.message("info",...t)}error(...t){this.message("error",...t)}warn(...t){this.message("warn",...t)}assert(...t){console.assert(...t)}debug(...t){this.message("debug",...t)}count(t){console.count(t)}countReset(t){console.countReset(t)}table(t,e){console.table(t,e)}time(t){this.message("time",t)}timeLog(t){this.message("timeLog",t)}timeEnd(t){this.message("timeEnd",t)}trace(...t){this.message("trace",...t)}group(t){this.message("group",t)}groupCollapsed(t){console.groupCollapsed(t)}groupEnd(){console.groupEnd()}clear(){console.clear()}registerType(t,e){this.types[t]||"string"==typeof t&&"string"==typeof e&&(this.types[t.toLowerCase()]=e)}registerTypes(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.registerType(e[t].type,e[t].ansi)}unregisterType(t){this.types[t]&&delete this.types[t]}}var a=r.Y;const h=new class{transitions={};storedIDs=[];version="1.0.0";constructor(){this.logger=new a,this.logger.registerType("Utils-Module","#ff6600")}decimalRand(t,e,i=1){return Number((Math.random()*(t-e)+e).toFixed(i))}rand(t,e){return t=Number(Math.random()*(t-e)+e),Math.round(t)}getPercentage(t,e){return 100*t/e}clamp(t,e=0,i=1){return Math.max(e,Math.min(t,i))}lerp(t,e,i){return(1-i)*t+i*e}flooredLerp(t,e,i){return Math.floor(this.lerp(t,e,i))}round(t,e=1){return Math.round(e*t)/e}normalize(t,e,i){return i-e==0?1:(t-e)/(i-e)}normalizeRanged(t,e,i){return i-e==0?1:(t=-(2*this.normalize(t,e,i)-1),this.clamp(t,-1,1))}within(t,e,i){return e<=t&&t<=i}formatIntegerWithCommas(t){return t.toFixed().toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}toRadians(t){return t*(Math.PI/180)}toDegrees(t){return t*(180/Math.PI)}pick(t){return t[Math.floor(Math.random()*t.length)]}removeProperties(t,e){if("object"==typeof t)for(const i in t)Array.isArray(e)&&e.includes(i)||t.hasOwnProperty(i)&&delete t[i]}prob(t){return!(t<=0)&&(100<=t||Math.floor(100*Math.random())+1<=t)}getInverseDirection(t){switch(t){case"north":return"south";case"south":return"north";case"east":return"west";case"west":return"east";case"northeast":return"southwest";case"northwest":return"southeast";case"southeast":return"northwest";case"southwest":return"northeast";default:this.logger.prefix("Utils-Module").error(`The direction ${t} is not supported.`)}}getAngleFromDirection(t){switch(t){case"north":return Math.PI/2;case"south":return 3*Math.PI/2;case"east":return 0;case"west":return Math.PI;case"northwest":return 3*Math.PI/4;case"northeast":return Math.PI/4;case"southwest":return 5*Math.PI/4;case"southeast":return 7*Math.PI/4;default:this.logger.prefix("Utils-Module").error(`The direction ${t} is not supported.`)}}centerRectangleOnParent(t,e,i,o,n,r){return{x:n+(i-t)/2,y:r+(o-e)/2}}getRandomAngle(){return Math.random()*(2*Math.PI)}getAngle(t,e){var i=t.y-e.y;return t=t.x-e.x,Math.atan2(i,t)}getAngle2(t,e){var i=t.y-e.y;return t=t.x-e.x,-1*(Math.atan2(i,t)-Math.PI)}convertRaWAngleToVyloCoords(t){return-1*(t-Math.PI)}getDistance(t,e){var i=t.y-e.y;return t=t.x-e.x,Math.sqrt(t*t+i*i)}calculateNewPositionFromDistanceAndAngle(t,e,i){var o={x:0,y:0};return o.x=t.x-e*Math.cos(i),o.y=t.y-e*Math.sin(i),o}calculateProportionalLength(t,e,i){return t/e*i}getDirection(t){return["east","northeast","north","northwest","west","southwest","south","southeast"][Math.abs(Math.floor(t*(180/Math.PI)/45+.5))%8]}linearDecay(t,e,i,o=.5){return Math.max(t*(1-e/i*o),1)}generateID(i=7){function t(){let e="";for(let t=0;t<i;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}let e=t();for(;this.storedIDs.includes(e);)e=t();return this.storedIDs.push(e),e}decimalToHex(t,e=6){return"#"+(t+Math.pow(16,e)).toString(16).slice(-e).toUpperCase()}addIntensity(t,e){var i=(t=this.grabColor(t).rgbArray)[0],o=t[1];t=t[2];let n=0,r=0,s=0;var a=0===i&&0===o&&0===t;return(i||a)&&(n=i+Math.floor(255*e/100)),(o||a)&&(r=o+Math.floor(255*e/100)),(t||a)&&(s=t+Math.floor(255*e/100)),this.grabColor(this.clamp(n,0,255),this.clamp(r,0,255),this.clamp(s,0,255)).hex}rgbToHex(t,e,i){return"#"+[this.clamp(t,0,255),this.clamp(e,0,255),this.clamp(i,0,255)].map(function(t){return t.toString(16).padStart(2,"0")}).join("")}hexToRgb(t){return t=(t=3===(t=t.replace("#","")).length?t.replace(new RegExp("(.)","g"),"$1$1"):t).match(new RegExp("..","g")),[this.clamp(parseInt(t[0],16),0,255),this.clamp(parseInt(t[1],16),0,255),this.clamp(parseInt(t[2],16),0,255)]}rgbToDecimal(t,e,i){return t<<16|e<<8|i}hexToDecimal(t){return t=t.replace("#",""),parseInt(t,16)}grabColor(t=this.getRandomColor(),e,i){let o,n;return"number"==typeof t&&"number"==typeof e&&"number"==typeof i?o=this.rgbToHex(t,e,i):("number"==typeof t&&(t=this.decimalToHex(t)),o=t,n=this.hexToRgb(o)),{hex:o.toLowerCase(),hexTagless:o.replace("#","").toLowerCase(),rgb:"rgb("+n[0]+","+n[1]+","+n[2]+")",rgbArray:n,rgbObject:{r:n[0],g:n[1],b:n[2]},rgbNormal:[Math.round(n[0]/255*100)/100,Math.round(n[1]/255*100)/100,Math.round(n[2]/255*100)/100],decimal:this.hexToDecimal(o)}}getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}getRandomColorBetween(t,e,i=.5){return this.flooredLerp(this.grabColor(t).decimal,this.grabColor(e).decimal,i)}transitionColor(h,t="#000",e="#fff",l=1e3,i,o){if(globalThis.window){const c="function"==typeof i?i:null,u="function"==typeof o?o:null;let r,s,a;h?(r=h.id||this.generateID(),s="GeneratedParticle"===h.type,a="object"==typeof h.color&&h.color.constructor===Object,this.transitions[r]&&this.cancelTransitionColor(r)):r=this.generateID(),this.transitions[r]={duration:l,timeTracker:s?h.info.lifetime:0};const p=this.grabColor(t).rgbArray,g=this.grabColor(e).rgbArray,d=this;return this.transitions[r].step=t=>{if(d.transitions[r]){if(s){if(!h.info)return void(d.transitions[r]&&this.cancelTransitionColor(r));if(h.info.owner&&h.info.owner.settings.paused)return}d.transitions[r].lastTime||(d.transitions[r].lastTime=t);var e=t-d.transitions[r].lastTime,i=(d.transitions[r].timeTracker+=e,e=Math.min(d.transitions[r].timeTracker/d.transitions[r].duration,1),parseInt(d.lerp(p[0],g[0],e),10)),o=parseInt(d.lerp(p[1],g[1],e),10),n=parseInt(d.lerp(p[2],g[2],e),10),i=d.grabColor(i,o,n);c&&c(i),h&&(a?(h.color.tint=i.decimal,h.color=h.color):h.color=i.hex),1<=e||d.transitions[r].timeTracker>=l?(d.transitions[r]&&this.cancelTransitionColor(r),u&&u(i)):(d.transitions[r].req=globalThis.requestAnimationFrame(d.transitions[r].step),d.transitions[r].lastTime=t)}},this.transitions[r].req=globalThis.requestAnimationFrame(this.transitions[r].step),r}}cancelTransitionColor(t){this.transitions[t]&&(globalThis.cancelAnimationFrame(this.transitions[t].req),delete this.transitions[t])}getPointRotated(t,e,i){var o=t.x+t.width*("object"==typeof t.anchor&&t.anchor.x?t.anchor.x:.5),n=(t=t.y+t.height*("object"==typeof t.anchor&&t.anchor.y?t.anchor.y:.5),i.x-o);return i=i.y-t,{x:n*Math.cos(e)-i*-Math.sin(e)+o,y:n*-Math.sin(e)+i*Math.cos(e)+t}}getPointsOfRotatedRect(t,e){return{tl:this.getPointRotated(t,e,{x:t.x,y:t.y}),tr:this.getPointRotated(t,e,{x:t.x+t.width,y:t.y}),bl:this.getPointRotated(t,e,{x:t.x,y:t.y+t.height}),br:this.getPointRotated(t,e,{x:t.x+t.width,y:t.y+t.height}),center:this.getPointRotated(t,e,{x:t.x+t.width/2,y:t.y+t.height/2})}}calculateIconOffset(t={width:32,height:32},e={x:.5,y:.5},i={x:1,y:1}){var o=t.width*i.x,i=t.height*i.y;return{x:e.x*(o-t.width),y:e.y*(i-t.height)}}};var l=n.c,c={d:(t,e)=>{for(var i in e)c.o(e,i)&&!c.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},u={};c.d(u,{Y:()=>p});class p{constructor(t){this.RESET="[0m",this.BRIGHT="[1m",this.DIM="[2m",this.UNDERSCORE="[4m",this.BLINK="[5m",this.REVERSE="[7m",this.HIDDEN="[8m",this.FG_BLACK="[30m",this.FG_RED="[31m",this.FG_GREEN="[32m",this.FG_YELLOW="[33m",this.FG_BLUE="[34m",this.FG_MAGENTA="[35m",this.FG_CYAN="[36m",this.FG_WHITE="[37m",this.FG_GRAY="[90m",this.BG_BLACK="[40m",this.BG_RED="[41m",this.BG_GREEN="[42m",this.BG_YELLOW="[43m",this.BG_BLUE="[44m",this.BG_MAGENTA="[45m",this.BG_CYAN="[46m",this.BG_WHITE="[47m",this.BG_GRAY="[100m",this.TYPE_SPACER_LENGTH=13,this.types={default:this.FG_WHITE},this.currentType="",this.SPACE_CHAR=" ",this.FG_COLORS={};for(let t=0;t<=255;t++)this.FG_COLORS[t]="[38;5;"+t+"m";this.BG_COLORS={};for(let t=0;t<=255;t++)this.BG_COLORS[t]="[48;5;"+t+"m";Array.isArray(t)&&this.registerTypes(t)}prefix(t){return"string"==typeof t&&(this.currentType=t),this}message(e="log",...i){var o=this.currentType||"";if(0===o.length)console[e](...i);else{var n=o.length>=this.TYPE_SPACER_LENGTH;let t=this.types[o.toLowerCase()]?this.types[o.toLowerCase()]:this.types.default;var r=t.includes("");r||(t="color: "+t),!globalThis.window||r?console[e](t+o+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-o.length,n?1:0))+"|"+this.RESET,...i):console[e]("%c"+o+this.SPACE_CHAR.repeat(Math.max(this.TYPE_SPACER_LENGTH-o.length,n?1:0))+"|",t,...i)}this.currentType=""}log(...t){this.message("log",...t)}info(...t){this.message("info",...t)}error(...t){this.message("error",...t)}warn(...t){this.message("warn",...t)}assert(...t){console.assert(...t)}debug(...t){this.message("debug",...t)}count(t){console.count(t)}countReset(t){console.countReset(t)}table(t,e){console.table(t,e)}time(t){this.message("time",t)}timeLog(t){this.message("timeLog",t)}timeEnd(t){this.message("timeEnd",t)}trace(...t){this.message("trace",...t)}group(t){this.message("group",t)}groupCollapsed(t){console.groupCollapsed(t)}groupEnd(){console.groupEnd()}clear(){console.clear()}registerType(t,e){this.types[t]||"string"==typeof t&&"string"==typeof e&&(this.types[t.toLowerCase()]=e)}registerTypes(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.registerType(e[t].type,e[t].ansi)}unregisterType(t){this.types[t]&&delete this.types[t]}}var d=u.Y;function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var y={731:function(t,e,i){t.exports=i(297)},297:function(a,m){var T,E;!function(){var t,p,h,g,d,e,l,i,y,f,o,n,r,c,u;function s(t){this.cmp=null!=t?t:p,this.nodes=[]}h=Math.floor,f=Math.min,p=function(t,e){return t<e?-1:e<t?1:0},y=function(t,e,i,o,n){var r;if(null==n&&(n=p),(i=null==i?0:i)<0)throw new Error("lo must be non-negative");for(null==o&&(o=t.length);i<o;)n(e,t[r=h((i+o)/2)])<0?o=r:i=r+1;return[].splice.apply(t,[i,i-i].concat(e)),e},d=function(t,e){var i,o;return null==e&&(e=p),i=t.pop(),t.length?(o=t[0],t[0]=i,u(t,0,e)):o=i,o},i=function(t,e,i){var o;return null==i&&(i=p),o=t[0],t[0]=e,u(t,0,i),o},l=function(t,e,i){var o;return null==i&&(i=p),t.length&&i(t[0],e)<0&&(e=(o=[t[0],e])[0],t[0]=o[1],u(t,0,i)),e},g=function(i,t){var e,o,n,r,s,a;for(null==t&&(t=p),s=[],o=0,n=(r=function(){a=[];for(var t=0,e=h(i.length/2);0<=e?t<e:e<t;0<=e?t++:t--)a.push(t);return a}.apply(this).reverse()).length;o<n;o++)e=r[o],s.push(u(i,e,t));return s},r=function(t,e,i){if(null==i&&(i=p),-1!==(e=t.indexOf(e)))return c(t,0,e,i),u(t,e,i)},o=function(t,e,i){var o,n,r,s,a;if(null==i&&(i=p),!(n=t.slice(0,e)).length)return n;for(g(n,i),r=0,s=(a=t.slice(e)).length;r<s;r++)o=a[r],l(n,o,i);return n.sort(i).reverse()},n=function(t,e,i){var o,n,r,s,a,h,l,c,u;if(null==i&&(i=p),10*e<=t.length){if((r=t.slice(0,e).sort(i)).length)for(n=r[r.length-1],s=0,h=(l=t.slice(e)).length;s<h;s++)i(o=l[s],n)<0&&(y(r,o,0,null,i),r.pop(),n=r[r.length-1]);return r}for(g(t,i),u=[],a=0,c=f(e,t.length);0<=c?a<c:c<a;0<=c?++a:--a)u.push(d(t,i));return u},c=function(t,e,i,o){var n,r,s;for(null==o&&(o=p),n=t[i];e<i&&o(n,r=t[s=i-1>>1])<0;)t[i]=r,i=s;return t[i]=n},u=function(t,e,i){var o,n,r,s,a;for(null==i&&(i=p),n=t.length,r=t[a=e],o=2*e+1;o<n;)(s=o+1)<n&&!(i(t[o],t[s])<0)&&(o=s),t[e]=t[o],o=2*(e=o)+1;return t[e]=r,c(t,a,e,i)},s.push=e=function(t,e,i){return null==i&&(i=p),t.push(e),c(t,0,t.length-1,i)},s.pop=d,s.replace=i,s.pushpop=l,s.heapify=g,s.updateItem=r,s.nlargest=o,s.nsmallest=n,s.prototype.push=function(t){return e(this.nodes,t,this.cmp)},s.prototype.pop=function(){return d(this.nodes,this.cmp)},s.prototype.peek=function(){return this.nodes[0]},s.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},s.prototype.replace=function(t){return i(this.nodes,t,this.cmp)},s.prototype.pushpop=function(t){return l(this.nodes,t,this.cmp)},s.prototype.heapify=function(){return g(this.nodes,this.cmp)},s.prototype.updateItem=function(t){return r(this.nodes,t,this.cmp)},s.prototype.clear=function(){return this.nodes=[]},s.prototype.empty=function(){return 0===this.nodes.length},s.prototype.size=function(){return this.nodes.length},s.prototype.clone=function(){var t=new s;return t.nodes=this.nodes.slice(0),t},s.prototype.toArray=function(){return this.nodes.slice(0)},s.prototype.insert=s.prototype.push,s.prototype.top=s.prototype.peek,s.prototype.front=s.prototype.peek,s.prototype.has=s.prototype.contains,s.prototype.copy=s.prototype.clone,t=s,E=[],void 0!==(E="function"==typeof(T=function(){return t})?T.apply(m,E):T)&&(a.exports=E)}.call(this)}},f={};function m(t){var e=f[t];return void 0===e&&(e=f[t]={exports:{}},y[t].call(e.exports,e,e.exports,m)),e.exports}m.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return m.d(e,{a:e}),e},m.d=function(t,e){for(var i in e)m.o(e,i)&&!m.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},m.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var T={},x=(function(){m.d(T,{x:function(){return i}});t=function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},Object.defineProperty(t,"prototype",{writable:!1});var w=t;function s(t){return(s="function"==typeof Symbol&&"symbol"==g(Symbol.iterator)?function(t){return g(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":g(t)})(t)}var O=function(){for(var t,e,e=function t(e,i,o,n,r){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.parent=e,this.x=i,this.y=o,this.costSoFar=n,this.simpleDistanceToTarget=r},i=e.prototype,o=[{key:"bestGuessDistance",value:function(){return this.costSoFar+this.simpleDistanceToTarget}}],n=0;n<o.length;n++){var r=o[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,(t=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return String(t);if("object"!=s(e=e.call(t,"string")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(r.key),"symbol"==s(t)?t:t+""),r)}return Object.defineProperty(e,"prototype",{writable:!1}),e}(),t=m(731),P=m.n(t),i={},M=1;i.js=function(){var c,r,u,p=!1,s={},o={},n={},h={},a=!0,g={},d=[],l=Number.MAX_VALUE,y=!1,f=(this.setAcceptableTiles=function(t){t instanceof Array?u=t:!isNaN(parseFloat(t))&&isFinite(t)&&(u=[t])},this.enableSync=function(){p=!0},this.disableSync=function(){p=!1},this.enableDiagonals=function(){y=!0},this.disableDiagonals=function(){y=!1},this.setGrid=function(t){c=t;for(var e=0;e<c.length;e++)for(var i=0;i<c[0].length;i++)o[c[e][i]]||(o[c[e][i]]=1)},this.setTileCost=function(t,e){o[t]=e},this.setAdditionalPointCost=function(t,e,i){void 0===n[e]&&(n[e]={}),n[e][t]=i},this.removeAdditionalPointCost=function(t,e){void 0!==n[e]&&delete n[e][t]},this.removeAllAdditionalPointCosts=function(){n={}},this.setDirectionalCondition=function(t,e,i){void 0===h[e]&&(h[e]={}),h[e][t]=i},this.removeAllDirectionalConditions=function(){h={}},this.setIterationsPerCalculation=function(t){l=t},this.avoidAdditionalPoint=function(t,e){void 0===s[e]&&(s[e]={}),s[e][t]=1},this.stopAvoidingAdditionalPoint=function(t,e){void 0!==s[e]&&delete s[e][t]},this.enableCornerCutting=function(){a=!0},this.disableCornerCutting=function(){a=!1},this.stopAvoidingAllAdditionalPoints=function(){s={}},this.findPath=function(t,e,i,o,n){function r(t){p?n(t):setTimeout(function(){n(t)})}if(void 0===u)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===c)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(t<0||e<0||i<0||o<0||t>c[0].length-1||e>c.length-1||i>c[0].length-1||o>c.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(t===i&&e===o)r([]);else{for(var s,a=c[o][i],h=!1,l=0;l<u.length;l++)if(a===u[l]){h=!0;break}if(!1!==h)return(s=new w).openList=new(P())(function(t,e){return t.bestGuessDistance()-e.bestGuessDistance()}),s.isDoneCalculating=!1,s.nodeHash={},s.startX=t,s.startY=e,s.endX=i,s.endY=o,s.callback=r,s.openList.push(x(s,s.startX,s.startY,null,1)),t=M++,g[t]=s,d.push(t),t;r(null)}},this.cancelPath=function(t){return t in g&&(delete g[t],!0)},this.calculate=function(){if(0!==d.length&&void 0!==c&&void 0!==u)for(r=0;r<l;r++){if(0===d.length)return;p&&(r=0);var t=d[0],e=g[t];if(void 0===e)d.shift();else if(0===e.openList.size())e.callback(null),delete g[t],d.shift();else{var i=e.openList.pop();if(e.endX===i.x&&e.endY===i.y){for(var o=[],n=(o.push({x:i.x,y:i.y}),i.parent);null!=n;)o.push({x:n.x,y:n.y}),n=n.parent;o.reverse(),e.callback(o),delete g[t],d.shift()}else(i.list=0)<i.y&&f(e,i,0,-1,+E(i.x,i.y-1)),i.x<c[0].length-1&&f(e,i,1,0,+E(i.x+1,i.y)),i.y<c.length-1&&f(e,i,0,1,+E(i.x,i.y+1)),0<i.x&&f(e,i,-1,0,+E(i.x-1,i.y)),y&&(0<i.x&&0<i.y&&(a||m(c,u,i.x,i.y-1,i)&&m(c,u,i.x-1,i.y,i))&&f(e,i,-1,-1,1.4*E(i.x-1,i.y-1)),i.x<c[0].length-1&&i.y<c.length-1&&(a||m(c,u,i.x,i.y+1,i)&&m(c,u,i.x+1,i.y,i))&&f(e,i,1,1,1.4*E(i.x+1,i.y+1)),i.x<c[0].length-1&&0<i.y&&(a||m(c,u,i.x,i.y-1,i)&&m(c,u,i.x+1,i.y,i))&&f(e,i,1,-1,1.4*E(i.x+1,i.y-1)),0<i.x)&&i.y<c.length-1&&(a||m(c,u,i.x,i.y+1,i)&&m(c,u,i.x-1,i.y,i))&&f(e,i,-1,1,1.4*E(i.x-1,i.y+1))}}},function(t,e,i,o,n){i=e.x+i,o=e.y+o,void 0!==s[o]&&void 0!==s[o][i]||!m(c,u,i,o,e)||(void 0===(i=x(t,i,o,e,n)).list?(i.list=1,t.openList.push(i)):e.costSoFar+n<i.costSoFar&&(i.costSoFar=e.costSoFar+n,i.parent=e,t.openList.updateItem(i)))}),m=function(t,e,i,o,n){var r=h[o]&&h[o][i];if(r){var s=T(n.x-i,n.y-o);if(!function(){for(var t=0;t<r.length;t++)if(r[t]===s)return 1}())return!1}for(var a=0;a<e.length;a++)if(t[o][i]===e[a])return!0;return!1},T=function(t,e){if(0===t&&-1===e)return i.TOP;if(1===t&&-1===e)return i.TOP_RIGHT;if(1===t&&0===e)return i.RIGHT;if(1===t&&1===e)return i.BOTTOM_RIGHT;if(0===t&&1===e)return i.BOTTOM;if(-1===t&&1===e)return i.BOTTOM_LEFT;if(-1===t&&0===e)return i.LEFT;if(-1===t&&-1===e)return i.TOP_LEFT;throw new Error("These differences are not valid: "+t+", "+e)},E=function(t,e){return n[e]&&n[e][t]||o[c[e][t]]},x=function(t,e,i,o,n){if(void 0!==t.nodeHash[i]){if(void 0!==t.nodeHash[i][e])return t.nodeHash[i][e]}else t.nodeHash[i]={};var r=v(e,i,t.endX,t.endY);return n=null!==o?o.costSoFar+n:0,o=new O(o,e,i,n,r),t.nodeHash[i][e]=o},v=function(t,e,i,o){var n,r;return y?(n=Math.abs(t-i))<(r=Math.abs(e-o))?1.4*n+r:1.4*r+n:(n=Math.abs(t-i))+Math.abs(e-o)}},i.TOP="TOP",i.TOP_RIGHT="TOP_RIGHT",i.RIGHT="RIGHT",i.BOTTOM_RIGHT="BOTTOM_RIGHT",i.BOTTOM="BOTTOM",i.BOTTOM_LEFT="BOTTOM_LEFT",i.LEFT="LEFT",i.TOP_LEFT="TOP_LEFT"}(),T.x);class E{static MAX_STUCK_COUNTER=100;static MAX_NEAREST_TILE_SEARCH=6;static MAX_DELTA_TIME=.03333333333;static CLAMPED_DELTA_TIME=.01666666666;static AVERSION_WEIGHT=10;static NO_TRAVEL_WEIGHT=-1;static DEBUGGER_DURATION=3e3;static storedMapTiles={};static DEFAULT_TILE_SIZE={width:32,height:32};tileSize={...E.DEFAULT_TILE_SIZE};version="1.0.0";instanceWeakMap=new WeakMap;lastTime=0;deltaTime=0;elapsedMS=0;activeInstances=[];constructor(){this.logger=new d,this.logger.registerType("Pathway-Module","#ff6600")}async to(n,r,s){if("object"==typeof n)if(n.mapName)if("object"!=typeof r)this.logger.prefix("Pathway-Module").error("Invalid type passed for pDestination. Expecting an object.");else if("object"!=typeof s)this.logger.prefix("Pathway-Module").error("Invalid type passed for pOptions. Expecting an object.");else{let e=this.instanceWeakMap.get(n);if(!e){const r="collision"===s.mode?"collision":"position";(e={trajectory:{angle:0,x:0,y:0,nextNodePos:null},currentPosition:{x:0,y:0},previousPosition:{x:0,y:0},stuckCounter:0,maxStuckCounter:E.MAX_STUCK_COUNTER,pathID:null,path:[],positionFromCenter:s.center,moving:null,mode:r,easystar:new x.js}).easystar.setIterationsPerCalculation(1e3),this.instanceWeakMap.set(n,e)}this.end(n);var a=this.getPositionFromInstance(n),h=VYLO.Map.getLocByPos(a.x,a.y,n.mapName);let t;Array.isArray(s.ignore)&&((t=[...s.ignore]).includes(h)||(t.push(h),t.push(n))),"number"==typeof s.maxStuckCounter&&(e.maxStuckCounter=s.maxStuckCounter),s.diagonal&&(e.easystar.enableDiagonals(),e.easystar.enableCornerCutting());var c=this.mapTilesToGrid(n.mapName,t);e.easystar.setGrid(c.grid),c.weights.forEach(t=>{e.easystar.setTileCost(t,t)}),e.easystar.setAcceptableTiles(c.acceptedTiles),console.log(c);const p=VYLO.Map.getMapSize(n.mapName),g=l.clamp(l.clamp(r.x,0,p.x)*this.tileSize.width+this.tileSize.width/2,0,p.xPos-this.tileSize.width),d=l.clamp(l.clamp(r.y,0,p.y)*this.tileSize.height+this.tileSize.height/2,0,p.yPos-this.tileSize.height),y=VYLO.Map.getLocByPos(g,d,n.mapName);let i=this.tileToNode(h),o=this.tileToNode(y);if(this.debugging){const n=VYLO.newDiob();n.atlasName="",n.width=this.tileSize.width,n.height=this.tileSize.height,n.tint=16777215,n.alpha=.7,n.plane=0,n.touchOpacity=0,n.touchOpacity=0,n.setTransition({alpha:0},-1,E.DEBUGGER_DURATION),y.addOverlay(n),setTimeout(()=>{y.removeOverlay(n)},E.DEBUGGER_DURATION)}if(this.isTileInvalid(h,t)){var u={west:!1,east:!1,north:!1,south:!1};if(s.nearest){for(const n of h.getContents())if(n.density){const s=this.getBlockingSides(n,a.x,a.y,g,d);s.west&&(u.west=!0),s.east&&(u.east=!0),s.north&&(u.north=!0),s.south&&(u.south=!0)}c=this.getNearestNode(n,i,a.x,a.y,u,!0,t);if(u.west){const r=VYLO.Map.getLocByPos(a.x+this.tileSize.width/2,a.y,n.mapName);this.isTileInvalid(r,t)&&c.x++}if(u.east){const r=VYLO.Map.getLocByPos(a.x-this.tileSize.width/2,a.y,n.mapName);this.isTileInvalid(r,t)&&c.x--}if(u.north){const r=VYLO.Map.getLocByPos(a.x,a.y+this.tileSize.height/2,n.mapName);this.isTileInvalid(r,t)&&c.y++}if(u.south){const r=VYLO.Map.getLocByPos(a.x,a.y-this.tileSize.height/2,n.mapName);this.isTileInvalid(r,t)&&c.y--}i=c}if(!s.nearest||u.west&&u.east&&u.north&&u.south){if(this.debugging){const n=VYLO.newDiob();n.atlasName="",n.width=this.tileSize.width,n.height=this.tileSize.height,n.tint=16711680,n.alpha=.7,n.plane=0,n.touchOpacity=0,n.touchOpacity=0,n.setTransition({alpha:0},-1,E.DEBUGGER_DURATION),startTile.addOverlay(n),setTimeout(()=>{y.removeOverlay(n)},E.DEBUGGER_DURATION)}return"function"==typeof self.onPathNotFound&&self.onPathNotFound(),console.log("path not found, origin tile"),void this.end(n)}}if(this.isTileInvalid(y,t)){if(!s.nearest)return"function"==typeof self.onPathNotFound&&self.onPathNotFound(),console.log("path not found, end tile"),this.debugging&&y.getOverlays().filter(t=>{t.tint=16711680}),void this.end(n);o=this.getNearestNode(n,o,g,d,void 0,void 0,t)}this.getPath(n,{x:i.x,y:i.y},{x:o.x,y:o.y})}else this.logger.prefix("Pathway-Module").error("Cannot generate a path. pInstance is not on a map.");else this.logger.prefix("Pathway-Module").error("Invalid type passed for pInstance. Expecting an object.")}track(t){this.activeInstances.includes(t)||(this.activeInstances.push(t),console.log("tracked"))}untrack(t){this.activeInstances.includes(t)&&(this.activeInstances.splice(this.activeInstances.indexOf(t),1),console.log("untracked"))}end(t){var e=this.instanceWeakMap.get(t);e?(e.pathID&&(e.easystar.cancelPath(e.pathID),e.pathID=null),e.easystar.disableDiagonals(),e.easystar.disableCornerCutting(),e.positionFromCenter=!1,e.trajectory.x=0,e.trajectory.y=0,e.trajectory.angle=0,e.trajectory.nextNodePos=null,e.stuckCounter=0,e.maxStuckCounter=E.MAX_STUCK_COUNTER,e.path.length=0,e.moving=!1,e.mode="collision",t.move(),this.untrack(t)):this.logger.prefix("Pathway-Module").error("No instance data found from pInstance. This instance is not engaged in pathfinding.")}getNearestNode(o,n,r,s,a={west:!1,east:!1,north:!1,south:!1},h,c){const u=this.getPositionFromInstance(o);if("object"==typeof n){let t,e={},i={};for(let t=1;t<=E.MAX_NEAREST_TILE_SEARCH;t++){var p=VYLO.Map.getLocByPos(r-t*this.tileSize.width/2,s,o.mapName),g=VYLO.Map.getLocByPos(r+t*this.tileSize.width/2,s,o.mapName),d=VYLO.Map.getLocByPos(r,s-t*this.tileSize.height/2,o.mapName),y=VYLO.Map.getLocByPos(r,s+t*this.tileSize.height/2,o.mapName);!p||a.west||p.density&&!c.includes(p)||p.getContents().filter(t=>{var e=!h||l.within(u.y,t.y+t.yOrigin,t.yOrigin+t.height);if(t.density&&!c.includes(t)&&e)return t.density}).length?(p&&(i[p.id]=p),t<=1&&(a.west=!0)):e[p.id]=p,!g||a.east||g.density&&!c.includes(g)||g.getContents().filter(t=>{var e=!h||l.within(u.y,t.y+t.yOrigin,t.yOrigin+t.height);if(t.density&&!c.includes(t)&&e)return t.density}).length?(g&&(i[g.id]=g),t<=1&&(a.east=!0)):e[g.id]=g,!d||a.north||d.density&&!c.includes(d)||d.getContents().filter(t=>{var e=!h||l.within(u.x,t.x+t.xOrigin,t.xOrigin+t.width);if(t.density&&!c.includes(t)&&e)return t.density}).length?(d&&(i[d.id]=d),t<=1&&(a.north=!0)):e[d.id]=d,!y||a.south||y.density&&!c.includes(y)||y.getContents().filter(t=>{var e=!h||l.within(u.x,t.x+t.xOrigin,t.xOrigin+t.width);if(t.density&&!c.includes(t)&&e)return t.density}).length?(y&&(i[y.id]=y),t<=1&&(a.south=!0)):e[y.id]=y}if(this.debugging)for(const o in i){const n=VYLO.newDiob();n.tint=16711680,n.atlasName="",n.width=this.tileSize.width,n.height=this.tileSize.height,n.tint=h?16753920:16711680,n.alpha=.3,n.plane=0,n.mouseOpacity=0,n.touchOpacity=0,n.setTransition({alpha:0},-1,E.DEBUGGER_DURATION),i[o].addOverlay(n),setTimeout(()=>{i[o].removeOverlay(n)},E.DEBUGGER_DURATION)}for(const o in e){if(this.debugging){const n=VYLO.newDiob();n.tint=16711680,n.atlasName="",n.width=this.tileSize.width,n.height=this.tileSize.height,n.tint=h?8900331:65280,n.alpha=.3,n.plane=0,n.mouseOpacity=0,n.touchOpacity=0,n.setTransition({alpha:0},-1,E.DEBUGGER_DURATION),e[o].addOverlay(n),setTimeout(()=>{e[o].removeOverlay(n)},E.DEBUGGER_DURATION)}t=this.tileToNode(e[o])}return t||n}}getBlockingSides(t,e,i,o,n){t=this.getPositionFromInstance(t);return{west:o<=t.x&&e>=t.x,east:o>=t.x&&e<=t.x,north:n<=t.y&&i>=t.y,south:n>=t.y&&i<=t.y}}getPositionFromInstance(t){var e=this.instanceWeakMap.get(t);if(e)return e.positionFromCenter?t.icon.width&&t.icon.height?(e.currentPosition.x=Math.floor(t.x+t.icon.width/2),e.currentPosition.y=Math.floor(t.y+t.icon.height/2)):(e.currentPosition.x=Math.floor(t.x+t.xOrigin+t.width/2),e.currentPosition.y=Math.floor(t.y+t.yOrigin+t.height/2)):(e.currentPosition.x=t.x,e.currentPosition.y=t.y),e.currentPosition}update(){this.activeInstances.forEach(t=>{const e=this.instanceWeakMap.get(t);if(e){var i=Date.now();if(this.elapsedMS=i-this.lastTime,this.deltaTime=this.elapsedMS/1e3,this.deltaTime>=E.MAX_DELTA_TIME&&(this.deltaTime=E.CLAMPED_DELTA_TIME),e.easystar.calculate(),Array.isArray(e.path)&&(e.path.length||e.moving)){var o=this.getPositionFromInstance(t);if(e.moving)Math.floor(l.getDistance(o,e.trajectory.nextNodePos))<=t.moveSettings.stepSize?(e.moving=!1,e.stuckCounter=0,e.path.length||("function"==typeof self.onPathComplete&&self.onPathComplete(e.pathID),this.end(t))):(e.trajectory.angle=l.getAngle2(o,e.trajectory.nextNodePos),e.trajectory.x=Math.cos(e.trajectory.angle),e.trajectory.y=-Math.sin(e.trajectory.angle),t.dir=l.getDirection(e.trajectory.angle),t.movePos(e.trajectory.x,e.trajectory.y),e.moving=!0);else{var n=e.path.shift(),r={x:n.x*this.tileSize.width-this.tileSize.width/2,y:n.y*this.tileSize.height-this.tileSize.height/2};if(this.debugging){const e=VYLO.Map.getLocByPos(r.x,r.y,t.mapName);if(e){const t=VYLO.newDiob();t.atlasName="",t.width=this.tileSize.width,t.height=this.tileSize.height,t.tint=23295,t.alpha=.8,t.plane=0,t.mouseOpacity=0,t.touchOpacity=0,t.setTransition({alpha:0},-1,E.DEBUGGER_DURATION),e.addOverlay(t),setTimeout(()=>{e.removeOverlay(t)},E.DEBUGGER_DURATION)}}if(e.trajectory.angle=l.getAngle2(o,r),e.trajectory.nextNodePos=r,e.trajectory.x=Math.cos(e.trajectory.angle),e.trajectory.y=-Math.sin(e.trajectory.angle),t.dir=l.getDirection(e.trajectory.angle),"collision"===e.mode?t.movePos(e.trajectory.x,e.trajectory.y):"position"===e.mode&&t.setPos(e.trajectory.x,e.trajectory.y,t.mapName),e.moving=!0,console.log("instanceData:",{...e},`angle: ${e.trajectory.angle}, dir: ${t.dir}, node:`,n,"nodePos:",r),this.debugging){const t=VYLO.newDiob();t.atlasName="",t.tint=16777215,t.width=this.tileSize.width,t.height=5,t.anchor=0,t.plane=0,t.mouseOpacity=0,t.touchOpacity=0,t.density=0,t.angle=e.trajectory.angle,t.setPos(o.x,o.y,self.mapName),t.setTransition({alpha:0},-1,E.DEBUGGER_DURATION),setTimeout(()=>{VYLO.delDiob(t)},E.DEBUGGER_DURATION)}}if(o.x===e.previousPosition.x&&o.y===e.previousPosition.y&&(e.stuckCounter++,e.stuckCounter>=e.maxStuckCounter)&&(this.end(t),"function"==typeof self.onPathStuck))return void self.onPathStuck();e.previousPosition=o}this.lastTime=i}})}setTileSize(t){var e;"number"==typeof t?this.tileSize={width:t,height:t}:"object"==typeof t?(e=t.width,t=t.height,"number"==typeof e&&(this.tileSize.width=e),"number"==typeof t&&(this.tileSize.height=t)):this.logger.prefix("Pathway-Module").error("Invalid type used for pTileSize")}isTileInvalid(t,e){var i=t.density&&!e.includes(t),t=t.getContents().some(t=>t.density&&!e.includes(t));return i||t}getPath(n,r,s){return new Promise((t,e)=>{const i=this.instanceWeakMap.get(n);if(i){let e;console.log("instanceData",i),console.log("pOrigin",r,"pDestination",s),console.log("about to find path");const o=i.easystar.findPath(r.x,r.y,s.x,s.y,t=>{Array.isArray(t)&&t.length?((e=t.map(t=>({x:t.x+1,y:t.y+1}))).shift(),i.path=e,i.pathID=o,"function"==typeof self.onPathFound&&self.onPathFound(),console.log("path found",e,o)):("function"==typeof self.onPathNotFound&&self.onPathNotFound(),console.log("path not found"),this.end(n))});this.track(n)}else this.logger.prefix("Pathway-Module").error("Instance data not found!"),e()})}toTwoDimensionalArray(t,e){let i=0;for(var o=[];i<t.length;)o.push(t.slice(i,i+=e));return o}tileToNode(t){if("string"==typeof t.mapName){if(E.storedMapTiles[t.mapName])return{x:(t=this.getIndexOf2DArray(E.storedMapTiles[t.mapName].tiles2d,t))[1],y:t[0]};this.logger.prefix("Pathway-Module").error("There is no stored grid for the map this tile belongs to.")}else this.logger.prefix("Pathway-Module").error("Invalid mapname found on pTile")}nodeToTile(t,e){return VYLO.Map.getLoc(e.x+1,e.y+1,t)}getIndexOf2DArray(e,i){for(let t=0;t<e.length;t++){var o=e[t].indexOf(i);if(-1<o)return[t,o]}}mapTilesToGrid(e,i){if("string"==typeof e)if(Array.isArray(i)){if(VYLO.Map.getMaps().includes(e)){let t;const o=[0],n=[],r=VYLO.Map.getMapSize(e);E.storedMapTiles[e]?t=[...E.storedMapTiles[e].tiles]:(t=VYLO.Map.getTiles(e),E.storedMapTiles[e]={tiles:[...t],tiles2d:this.toTwoDimensionalArray([...t],r.x)});e=t.map(t=>{let e="number"==typeof t.pathwayWeight?t.pathwayWeight:0;if(t.density||t.getContents().some(t=>t.density&&!i.includes(t)))e=E.NO_TRAVEL_WEIGHT;else for(const i of t.getContents())"number"==typeof i.pathwayWeight&&(e+=i.pathwayWeight);return e!==E.NO_TRAVEL_WEIGHT&&0!==e&&(o.includes(e)||o.push(e),n.includes(e)||n.push(e)),e});return{acceptedTiles:o,grid:this.toTwoDimensionalArray(e,r.x),weights:n}}this.logger.prefix("Pathway-Module").error("pMapName was not found in VYLO.")}else this.logger.prefix("Pathway-Module").error("Invalid type for pIgnoreList.");else this.logger.prefix("Pathway-Module").error("Invalid type for pMapName.")}}const v=new E,w="undefined"==typeof window,O=v.update.bind(v);if(w)setInterval(O,16);else{const t=()=>{O(),requestAnimationFrame(t)};requestAnimationFrame(t)}var P=e.Z;export{P as Pathway};